
---
categories: äººå·¥æ™ºèƒ½
cover: https://cdn-images-1.readmedium.com/v2/resize:fit:800/0*XlqkUK1qiERGWmg9.png
date: '2024-06-10 15:02:39'
tags:
  - LLM
  - RAG
  - æœºå™¨å­¦ä¹ 
title: å¦‚ä½•ä½¿ç”¨ RAGAs æ¡†æ¶è¯„ä¼°æ‚¨çš„ RAG

---
## LLM åŒèƒèƒè¯¾ç¨‹ï¼šæ„å»ºç”Ÿäº§å°±ç»ªçš„AIå¤åˆ¶å“

# å¦‚ä½•ä½¿ç”¨RAGAsæ¡†æ¶è¯„ä¼°ä½ çš„RAG

## å­¦ä¹ ä½¿ç”¨ RAGAs æ¡†æ¶ï¼Œéµå¾ªè¡Œä¸šæœ€ä½³å®è·µè¯„ä¼°æ‚¨çš„ RAG æ¨¡å‹ã€‚äº†è§£æ£€ç´¢ä¸ç”Ÿæˆç‰¹å®šæŒ‡æ ‡ï¼Œä»¥åŠåˆ©ç”¨ CometML LLM è¿›è¡Œé«˜çº§ RAG é“¾ç›‘æ§ã€‚

*â†’ [**LLM Twin**](https://medium.com/decodingml/llm-twin-course/home) å…è´¹è¯¾ç¨‹çš„ç¬¬ 10 è¯¾ï¼Œå…± 11 è¯¾*

**ä»€ä¹ˆæ˜¯ä½ çš„ LLM Twinï¼Ÿ** å®ƒæ˜¯ä¸€ä¸ª AI è§’è‰²ï¼Œé€šè¿‡èå…¥ä½ çš„é£æ ¼ã€ä¸ªæ€§å’Œå£°éŸ³ï¼Œä½¿å…¶å†™ä½œé£æ ¼ä¸ä½ ç›¸ä¼¼ã€‚



# ä¸ºä½•æœ¬è¯¾ç¨‹ä¸ä¼—ä¸åŒï¼Ÿ

*é€šè¿‡å®Œæˆâ€œ[**LLM Twin: æ„å»ºä½ çš„ç”Ÿäº§å°±ç»ªå‹AIå¤åˆ¶å“**](https://readmedium.com/the-role-of-feature-stores-in-fine-tuning-llms-22bd60afd4b9)**â€****å…è´¹è¯¾ç¨‹ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•è®¾è®¡ã€è®­ç»ƒå¹¶éƒ¨ç½²ä¸€ä¸ªç”±LLMsã€å‘é‡æ•°æ®åº“åŠLLMOpsæœ€ä½³å®è·µé©±åŠ¨çš„ç”Ÿäº§å°±ç»ªå‹ä¸ªäººLLMåŒèƒèƒç³»ç»Ÿ*ã€‚

> ***ä¸ºä½•ä½ åº”è¯¥å…³æ³¨ï¼ŸğŸ«µ***

> ***â†’ ä¸å†å±€é™äºå­¤ç«‹çš„è„šæœ¬æˆ–Notebookï¼*** *é€šè¿‡æ„å»ºå¹¶éƒ¨ç½²ä¸€ä¸ªç«¯åˆ°ç«¯çš„ç”Ÿäº§çº§LLMç³»ç»Ÿï¼Œå­¦ä¹ ç”Ÿäº§çº§æœºå™¨å­¦ä¹ ã€‚*

# æœ¬è¯¾ç¨‹ç»“æŸæ—¶ï¼Œä½ å°†å­¦ä¼šæ„å»ºä»€ä¹ˆï¼Ÿ

ä½ å°†**å­¦ä¹ **å¦‚ä½•ä»**å¤´åˆ°å°¾**è®¾è®¡å’Œ**æ„å»ºä¸€ä¸ªçœŸå®çš„LLMç³»ç»Ÿ**â€”â€”ä»**æ•°æ®æ”¶é›†**åˆ°**éƒ¨ç½²**ã€‚

ä½ è¿˜å°†**å­¦ä¹ **åˆ©ç”¨**MLOpsæœ€ä½³å®è·µ**ï¼Œä¾‹å¦‚å®éªŒè·Ÿè¸ªå™¨ã€æ¨¡å‹æ³¨å†Œè¡¨ã€æç¤ºç›‘æ§å’Œç‰ˆæœ¬æ§åˆ¶ã€‚

**æœ€ç»ˆç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ** æ„å»ºå¹¶éƒ¨ç½²ä½ è‡ªå·±çš„LLMåŒèƒèƒã€‚

**ä»€ä¹ˆæ˜¯LLMåŒèƒèƒï¼Ÿ** å®ƒæ˜¯ä¸€ä¸ªAIè§’è‰²ï¼Œé€šè¿‡å°†æŸäººçš„é£æ ¼å’Œä¸ªæ€§èå…¥LLMä¸­ï¼Œå­¦ä¼šåƒæŸäººä¸€æ ·å†™ä½œã€‚

*LLMåŒèƒèƒçš„**æ¶æ„**åˆ†ä¸º**4ä¸ªPythonå¾®æœåŠ¡**ï¼š*

1. ***æ•°æ®æ”¶é›†ç®¡é“ï¼š*** ä»å„ç§ç¤¾äº¤åª’ä½“å¹³å°æŠ“å–ä½ çš„æ•°å­—æ•°æ®ã€‚é€šè¿‡ä¸€ç³»åˆ—ETLç®¡é“æ¸…ç†ã€æ ‡å‡†åŒ–å¹¶åŠ è½½æ•°æ®åˆ°NoSQLæ•°æ®åº“ã€‚ä½¿ç”¨CDCæ¨¡å¼å°†æ•°æ®åº“æ›´æ”¹å‘é€åˆ°é˜Ÿåˆ—ã€‚ï¼ˆéƒ¨ç½²åœ¨AWSä¸Šï¼‰
2. ***ç‰¹å¾ç®¡é“ï¼š*** é€šè¿‡Bytewaxæµç®¡é“ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚æ¯æ¡æ¶ˆæ¯å°†è¢«å®æ—¶æ¸…ç†ã€åˆ†å—ã€åµŒå…¥ï¼ˆä½¿ç”¨Superlinkedï¼‰å¹¶åŠ è½½åˆ°Qdrantå‘é‡æ•°æ®åº“ä¸­ã€‚ï¼ˆéƒ¨ç½²åœ¨AWSä¸Šï¼‰
3. ***è®­ç»ƒç®¡é“ï¼š*** åŸºäºä½ çš„æ•°å­—æ•°æ®åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†ã€‚ä½¿ç”¨QLoRAå¯¹LLMè¿›è¡Œå¾®è°ƒã€‚ä½¿ç”¨Comet MLçš„å®éªŒè·Ÿè¸ªå™¨ç›‘æ§å®éªŒã€‚è¯„ä¼°å¹¶å°†æœ€ä½³æ¨¡å‹ä¿å­˜åˆ°Cometçš„æ¨¡å‹æ³¨å†Œè¡¨ä¸­ã€‚ï¼ˆéƒ¨ç½²åœ¨Qwakä¸Šï¼‰
4. ***æ¨ç†ç®¡é“ï¼š*** ä»Cometçš„æ¨¡å‹æ³¨å†Œè¡¨åŠ è½½å¹¶é‡åŒ–å¾®è°ƒåçš„LLMã€‚å°†å…¶éƒ¨ç½²ä¸ºREST APIã€‚ä½¿ç”¨RAGå¢å¼ºæç¤ºã€‚ä½¿ç”¨ä½ çš„LLMåŒèƒèƒç”Ÿæˆå†…å®¹ã€‚ä½¿ç”¨Cometçš„æç¤ºç›‘æ§ä»ªè¡¨æ¿ç›‘æ§LLMã€‚ï¼ˆéƒ¨ç½²åœ¨Qwakä¸Šï¼‰

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/0*JLIFYSP0bPKb0YfB.png)

åœ¨è¿™4ä¸ªå¾®æœåŠ¡ä¸­ï¼Œä½ å°†å­¦ä¹ é›†æˆ3ä¸ªæ— æœåŠ¡å™¨å·¥å…·ï¼š

* [Comet ML](https://www.comet.com/signup/?utm_source=decoding_ml&utm_medium=partner&utm_content=medium) ä½œä¸ºä½ çš„MLå¹³å°ï¼›
* [Qdrant](https://qdrant.tech/?utm_source=decodingml&utm_medium=referral&utm_campaign=llm-course) ä½œä¸ºä½ çš„å‘é‡æ•°æ®åº“ï¼›
* [Qwak](https://www.qwak.com/lp/end-to-end-mlops/?utm_source=medium&utm_medium=referral&utm_campaign=decodingml) ä½œä¸ºä½ çš„MLåŸºç¡€è®¾æ–½ï¼›

# é€‚ç”¨å¯¹è±¡

**å—ä¼—ï¼š** å¸Œæœ›å­¦ä¹ ä½¿ç”¨LLMOpsç¨³å¥åŸåˆ™æ„å»ºç”Ÿäº§å°±ç»ªå‹LLMç³»ç»Ÿçš„MLEã€DEã€DSæˆ–SWEã€‚**çº§åˆ«ï¼š** ä¸­çº§**å…ˆå†³æ¡ä»¶ï¼š** å…·å¤‡Pythonã€æœºå™¨å­¦ä¹ å’Œäº‘è®¡ç®—çš„åŸºç¡€çŸ¥è¯†

# ä½ å°†å¦‚ä½•å­¦ä¹ ï¼Ÿ

æœ¬è¯¾ç¨‹åŒ…å«**11ä¸ªå®è·µæ€§ä¹¦é¢è¯¾ç¨‹**ä»¥åŠä½ å¯ä»¥åœ¨[GitHubä¸Šè®¿é—®çš„å¼€æºä»£ç ](https://github.com/decodingml/llm-twin-course)ã€‚

ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„èŠ‚å¥é˜…è¯»æ‰€æœ‰å†…å®¹ã€‚*â†’ ä¸ºäº†æœ€å¤§é™åº¦åœ°ä»æœ¬è¯¾ç¨‹ä¸­è·ç›Šï¼Œæˆ‘ä»¬é¼“åŠ±ä½ åœ¨å­¦ä¹ è¯¾ç¨‹çš„åŒæ—¶å…‹éš†å¹¶è¿è¡Œè¯¥ä»“åº“ã€‚*

# è´¹ç”¨é—®é¢˜ï¼Ÿ

**æ–‡ç« **å’Œ**ä»£ç **å‡ä¸º**å®Œå…¨å…è´¹**ã€‚å®ƒä»¬å°†å§‹ç»ˆä¿æŒå…è´¹ã€‚

ä½†å¦‚æœä½ è®¡åˆ’åœ¨é˜…è¯»çš„åŒæ—¶è¿è¡Œä»£ç ï¼Œä½ å¿…é¡»çŸ¥é“æˆ‘ä»¬ä½¿ç”¨äº†å‡ ç§äº‘å·¥å…·ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿé¢å¤–è´¹ç”¨ã€‚

**äº‘è®¡ç®—å¹³å°ï¼ˆ[AWS](https://aws.amazon.com/)ã€[Qwak](https://www.qwak.com/lp/end-to-end-mlops/?utm_source=medium&utm_medium=referral&utm_campaign=decodingml)ï¼‰é‡‡ç”¨æŒ‰ä½¿ç”¨ä»˜è´¹çš„å®šä»·è®¡åˆ’ã€‚Qwakæä¾›æ•°å°æ—¶çš„å…è´¹è®¡ç®—æ—¶é—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°½åŠ›å°†æˆæœ¬é™è‡³æœ€ä½ã€‚**

å¯¹äºå…¶ä»–æ— æœåŠ¡å™¨å·¥å…·ï¼ˆ[Qdrant](https://qdrant.tech/?utm_source=decodingml&utm_medium=referral&utm_campaign=llm-course)ã€[Comet](https://www.comet.com/signup/?utm_source=decoding_ml&utm_medium=partner&utm_content=medium)ï¼‰ï¼Œæˆ‘ä»¬å°†åšæŒä½¿ç”¨å®ƒä»¬çš„å…è´¹å¢å€¼ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ä¸æ”¶å–è´¹ç”¨ã€‚

# è®¤è¯†ä½ çš„è€å¸ˆä»¬ï¼

æœ¬è¯¾ç¨‹ç”±[è§£ç æœºå™¨å­¦ä¹ ](https://medium.com/decodingml)å›¢é˜Ÿåˆ›å»ºï¼Œæˆå‘˜åŒ…æ‹¬ï¼š

* [Paul Iusztin](https://www.linkedin.com/in/pauliusztin/) | é«˜çº§æœºå™¨å­¦ä¹ ä¸MLOpså·¥ç¨‹å¸ˆ
* [Alex Vesa](https://www.linkedin.com/in/vesaalexandru/) | é«˜çº§äººå·¥æ™ºèƒ½å·¥ç¨‹å¸ˆ
* [Alex Razvant](https://www.linkedin.com/in/arazvant/) | é«˜çº§æœºå™¨å­¦ä¹ ä¸MLOpså·¥ç¨‹å¸ˆ

> *ğŸ”— **æŸ¥çœ‹** [GitHubä¸Šçš„ä»£ç ](https://github.com/decodingml/llm-twin-course) [1] å¹¶ç»™æˆ‘ä»¬ä¸€ä¸ªâ­ï¸ä»¥ç¤ºæ”¯æŒ*

# è¯¾ç¨‹å†…å®¹

*æœ¬è¯¾ç¨‹åˆ†ä¸º11ä¸ªè¯¾æ—¶ã€‚æ¯ç¯‡Mediumæ–‡ç« å³ä¸ºä¸€ä¸ªè¯¾æ—¶ã€‚*

1. [æ„å»ºç”Ÿäº§å°±ç»ªå‹LLMç³»ç»Ÿçš„ç«¯åˆ°ç«¯æ¡†æ¶ï¼šæ‰“é€ ä½ çš„LLMåŒèƒèƒ](https://readmedium.com/an-end-to-end-framework-for-production-ready-llm-systems-by-building-your-llm-twin-2cc6bb01141f)
2. [ç”Ÿæˆå¼AIæ—¶ä»£æ•°æ®ç®¡é“çš„é‡è¦æ€§](https://readmedium.com/the-importance-of-data-pipelines-in-the-era-of-generative-ai-673e1505a861)
3. [å˜æ›´æ•°æ®æ•è·ï¼šå®ç°äº‹ä»¶é©±åŠ¨æ¶æ„](https://readmedium.com/the-3nd-out-of-11-lessons-of-the-llm-twin-free-course-ba82752dad5a)
4. [å®æ—¶å¾®è°ƒLLMå’ŒRAGçš„SOTA Pythonæµå¼ç®¡é“](https://readmedium.com/sota-python-streaming-pipelines-for-fine-tuning-llms-and-rag-in-real-time-82eb07795b87)
5. [ä½ å¿…é¡»äº†è§£çš„4ç§é«˜çº§RAGç®—æ³•](https://readmedium.com/the-4-advanced-rag-algorithms-you-must-know-to-implement-5d0c7f1199d2)
6. [ç‰¹å¾å­˜å‚¨åœ¨å¾®è°ƒLLMä¸­çš„ä½œç”¨](https://readmedium.com/the-role-of-feature-stores-in-fine-tuning-llms-22bd60afd4b9)
7. [å¦‚ä½•ä½¿ç”¨Qwakå’ŒComet MLåœ¨è‡ªå®šä¹‰æ•°æ®é›†ä¸Šå¤§è§„æ¨¡å¾®è°ƒLLM](https://readmedium.com/how-to-fine-tune-llms-on-custom-datasets-at-scale-using-qwak-and-cometml-12216a777c34)
8. [è¯„ä¼°å¾®è°ƒLLMæ¨¡å‹çš„æœ€ä½³å®è·µ](https://readmedium.com/best-practices-when-evaluating-fine-tuned-llms-47f02f5164c2)
9. [æ„å»ºå¯æ‰©å±•ä¸”æˆæœ¬æ•ˆç›Šé«˜çš„LLM & RAGæ¨ç†ç®¡é“](https://readmedium.com/architect-scalable-and-cost-effective-llm-rag-inference-pipelines-73b94ef82a99)
10. **å¦‚ä½•ä½¿ç”¨RAGAsæ¡†æ¶è¯„ä¼°ä½ çš„RAGç®¡é“**
11. æ€»ç»“ã€‚æˆ‘ä»¬å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ[æ¨¡å—6] â€¦å¾…æ›´æ–°

**ä¸ºäº†æ›´å¥½åœ°ç†è§£**è¯¾ç¨‹ç›®æ ‡ã€æŠ€æœ¯ç»†èŠ‚åŠç³»ç»Ÿè®¾è®¡ â†’ [æŸ¥çœ‹ç¬¬1è¯¾](https://readmedium.com/an-end-to-end-framework-for-production-ready-llm-systems-by-building-your-llm-twin-2cc6bb01141f)

**è®©æˆ‘ä»¬ä»ç¬¬10è¯¾å¼€å§‹**â†“â†“â†“

# ç¬¬10è¯¾ï¼šå¦‚ä½•ä½¿ç”¨RAGAsæ¡†æ¶è¯„ä¼°æ‚¨çš„RAGç®¡é“

åœ¨è¿›å…¥è¯¾ç¨‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ï¼Œäº†è§£**æˆ‘ä»¬æ˜¯å¦‚ä½•èµ°åˆ°è¿™ä¸€æ­¥çš„**ï¼š

â†’ **ç¬¬8è¯¾**ä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨äºLLMåœ¨å„ç§ä»»åŠ¡ä¸­çš„å¸¸è§è¯„ä¼°æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å®¹ç”Ÿæˆæ–¹é¢ï¼Œæˆ‘ä»¬é€šè¿‡APIä½¿ç”¨äº†ä¸€ä¸ªæ›´å¤§çš„æ¨¡å‹ï¼ˆGPT3.5-Turboï¼‰æ¥è¯„ä¼°è¿è´¯æ€§å¹¶é‡åŒ–å…¶ä»–LLMç”ŸæˆæŒ‡æ ‡ã€‚

â†’ **ç¬¬9è¯¾**ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨[Qwak [2]](https://www.qwak.com/lp/end-to-end-mlops/?utm_source=medium&utm_medium=referral&utm_campaign=decodingml)ä¸Šå®ç°å’Œéƒ¨ç½²LLMåŒç³»ç»Ÿæ¨ç†ç®¡é“ã€‚æˆ‘ä»¬è¿­ä»£äº†åŸºäºå¾®æœåŠ¡çš„è®¾è®¡ï¼Œå°†MLå’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ä¸ºä¸¤ä¸ªå±‚æ¬¡ã€‚

**ç¬¬10è¯¾**æˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨**RAGè¯„ä¼°é€»è¾‘**ä¸Šã€‚

**åœ¨è¿™é‡Œ**ï¼Œæˆ‘ä»¬å°†å±•ç¤ºæˆ‘ä»¬æ‰§è¡Œçš„è¯„ä¼°æ­¥éª¤ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•é€æ­¥æ„å»ºè¯„ä¼°è´Ÿè½½ã€‚æˆ‘ä»¬å°†ä»‹ç»æœ€ä½³çš„RAGè¯„ä¼°æ¡†æ¶ä¹‹ä¸€ï¼ˆ[RAGAs [5]](https://github.com/explodinggradients/ragas)ï¼‰ï¼Œå¹¶è®¨è®ºå…¶æä¾›çš„æŒ‡æ ‡ã€å®ç°å’Œå…¶ä»–ä¼˜ç§€åŠŸèƒ½ã€‚

**æœ€ç»ˆ**ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•é€šè¿‡å•ç‹¬è®¾è®¡æ¯ä¸ªé“¾æ­¥éª¤ã€é™„åŠ å…ƒæ•°æ®å¹¶è®°å½•åˆ°CometML-LLMæ¥ç›‘æ§å¤æ‚çš„é“¾ã€‚

**æœ¬è¯¾æˆ‘ä»¬å°†å­¦ä¹ çš„å†…å®¹**ï¼š

* **RAG**åº”ç”¨çš„**è¯„ä¼°**æŠ€æœ¯ã€‚
* å¦‚ä½•ä½¿ç”¨**RAGAs**è¯„ä¼°RAGåº”ç”¨ã€‚
* å¦‚ä½•æ„å»ºå…ƒæ•°æ®é“¾å¹¶å°†å…¶è®°å½•åˆ°CometML-LLMã€‚
* **LLM-Twin RAGè¯„ä¼°**å·¥ä½œæµç¨‹ã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*lbJ7M1Hpmck-oQLr02NanA.png)

# ç›®å½•

1. <b>ä»€ä¹ˆæ˜¯RAGè¯„ä¼°ï¼Ÿ</b>
2. <b>RAGAsæ¡†æ¶</b>
3. <b>å¦‚ä½•è¯„ä¼°æˆ‘ä»¬çš„RAGåº”ç”¨</b>
4. <b>é«˜çº§æç¤ºé“¾ç›‘æ§</b>
5. <b>ç»“è®º</b>

# ä»€ä¹ˆæ˜¯RAGè¯„ä¼°ï¼Ÿ

RAGè¯„ä¼°æ¶‰åŠè¯„ä¼°æ¨¡å‹å¦‚ä½•å°†æ£€ç´¢åˆ°çš„ä¿¡æ¯æ•´åˆåˆ°å…¶å“åº”ä¸­ã€‚è¿™ä¸ä»…éœ€è¦è¯„ä¼°ç”Ÿæˆæ–‡æœ¬çš„è´¨é‡ï¼Œè¿˜éœ€è¦è¯„ä¼°æ£€ç´¢ä¿¡æ¯çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ï¼Œä»¥åŠå®ƒå¦‚ä½•æœ‰æ•ˆåœ°å¢å¼ºæœ€ç»ˆè¾“å‡ºã€‚

æ„å»ºRAGæµæ°´çº¿ç›¸å½“ç®€å•ã€‚æ‚¨åªéœ€è¦ä¸€ä¸ªå‘é‡æ•°æ®åº“çŸ¥è¯†åº“ã€ä¸€ä¸ªLLMæ¥å¤„ç†æ‚¨çš„æç¤ºï¼Œä»¥åŠè¿™äº›æ¨¡å—ä¹‹é—´äº¤äº’çš„é¢å¤–é€»è¾‘ã€‚

ç”±äºRAGæµæ°´çº¿çš„â€œç‹¬ç«‹â€ç»„ä»¶ï¼Œè¾¾åˆ°ä»¤äººæ»¡æ„çš„æ€§èƒ½æ°´å¹³å¸¦æ¥äº†æŒ‘æˆ˜ï¼š

* **æ£€ç´¢å™¨ â€”** è´Ÿè´£æŸ¥è¯¢çŸ¥è¯†æ•°æ®åº“å¹¶æ£€ç´¢ä¸ç”¨æˆ·æŸ¥è¯¢åŒ¹é…çš„é¢å¤–ä¸Šä¸‹æ–‡ã€‚
* **ç”Ÿæˆå™¨ â€”** åŒ…å«LLMæ¨¡å—ï¼ŒåŸºäºä¸Šä¸‹æ–‡å¢å¼ºçš„æç¤ºç”Ÿæˆç­”æ¡ˆã€‚

åœ¨è¯„ä¼°RAGæµæ°´çº¿æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»**åˆ†åˆ«å’Œå…±åŒè¯„ä¼°è¿™ä¸¤ä¸ªç»„ä»¶**ï¼Œä»¥äº†è§£RAGæµæ°´çº¿æ˜¯å¦ä»¥åŠåœ¨å“ªäº›æ–¹é¢ä»éœ€æ”¹è¿›ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬è¯†åˆ«å…¶â€œè´¨é‡â€ã€‚æ­¤å¤–ï¼Œä¸ºäº†äº†è§£å…¶æ€§èƒ½æ˜¯å¦åœ¨æå‡ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå®šé‡è¯„ä¼°ã€‚

# RAGAsæ¡†æ¶

Ragasæ˜¯ä¸€ä¸ªå¸®åŠ©æ‚¨è¯„ä¼°æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç®¡é“çš„æ¡†æ¶ã€‚å·²æœ‰å·¥å…·å’Œæ¡†æ¶ï¼ˆä¾‹å¦‚LLamaIndexï¼‰å¸®åŠ©æ‚¨æ„å»ºè¿™äº›ç®¡é“ï¼Œä½†è¯„ä¼°å’Œé‡åŒ–ç®¡é“æ€§èƒ½å¯èƒ½å¾ˆå›°éš¾ã€‚**è¿™å°±æ˜¯Ragasï¼ˆRAGè¯„ä¼°ï¼‰çš„ç”¨æ­¦ä¹‹åœ°ã€‚**

> [RAGAs [5]](https://github.com/explodinggradients/ragas)æ¡†æ¶ï¼ˆ5.3k â­ï¸ï¼‰æ˜¯å¼€æºçš„ï¼Œå±äºexplodinggradientså›¢é˜Ÿï¼Œå¹¶é™„å¸¦ä¸€ç¯‡è®ºæ–‡æäº¤ï¼š[RAGAsè®ºæ–‡ [6]](https://arxiv.org/abs/2309.15217)

RAGAsçš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€æ˜¯**åŸºäºæŒ‡æ ‡çš„å¼€å‘**ï¼ˆMDDï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ä¾èµ–æ•°æ®åšå‡ºæ˜æ™ºå†³ç­–çš„äº§å“å¼€å‘æ–¹æ³•ã€‚é‡ç‚¹æ˜¯åˆ©ç”¨å¼ºå¤§çš„LLMåœ¨åå°è¿›è¡Œæœ‰é’ˆå¯¹æ€§çš„è¯„ä¼°è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä¾èµ–HITLï¼ˆäººåœ¨å›è·¯ä¸­ï¼‰è¿›è¡Œåœ°é¢çœŸå®æ ‡æ³¨ã€‚

## RAGAs æŒ‡æ ‡

è®©æˆ‘ä»¬é€ä¸€äº†è§£ **[RAGAs æŒ‡æ ‡ [4]](https://docs.ragas.io/en/latest/concepts/metrics/index.html)** æ‰€æä¾›çš„å„é¡¹æŒ‡æ ‡ï¼š

**æ£€ç´¢é˜¶æ®µ** ğŸ”½ æŒ‡æ ‡ï¼š

1. **ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦**ï¼šè¯„ä¼°ç”¨äºç”Ÿæˆç­”æ¡ˆçš„ä¸Šä¸‹æ–‡çš„ç²¾ç¡®åº¦ï¼Œç¡®ä¿ä»ä¸Šä¸‹æ–‡ä¸­é€‰æ‹©äº†ç›¸å…³ä¿¡æ¯ã€‚
2. **ä¸Šä¸‹æ–‡ç›¸å…³æ€§**ï¼šè¡¡é‡æ‰€é€‰ä¸Šä¸‹æ–‡ä¸é—®é¢˜çš„ç›¸å…³ç¨‹åº¦ï¼Œæœ‰åŠ©äºæ”¹è¿›ä¸Šä¸‹æ–‡é€‰æ‹©ä»¥æé«˜ç­”æ¡ˆå‡†ç¡®æ€§ã€‚
3. **ä¸Šä¸‹æ–‡å¬å›ç‡**ï¼šè¡¡é‡æ˜¯å¦æ£€ç´¢åˆ°äº†å›ç­”é—®é¢˜æ‰€éœ€çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯ã€‚
4. **ä¸Šä¸‹æ–‡å®ä½“å¬å›ç‡**ï¼šè¯„ä¼°ä¸Šä¸‹æ–‡ä¸­å®ä½“çš„å¬å›æƒ…å†µï¼Œç¡®ä¿åœ¨ä¸Šä¸‹æ–‡æ£€ç´¢ä¸­æ²¡æœ‰é—æ¼é‡è¦å®ä½“ã€‚

**ç”Ÿæˆé˜¶æ®µ** ğŸ”½ æŒ‡æ ‡ï¼š

1. **å¿ å®åº¦**ï¼šè¡¡é‡ç”Ÿæˆçš„ç­”æ¡ˆåœ¨å¤šå¤§ç¨‹åº¦ä¸Šå‡†ç¡®åæ˜ äº†æºå†…å®¹ï¼Œç¡®ä¿ç”Ÿæˆçš„å†…å®¹çœŸå®å¯é ã€‚
2. **ç­”æ¡ˆç›¸å…³æ€§**ï¼šè¯„ä¼°ç­”æ¡ˆä¸æ‰€æé—®é¢˜çš„ç›¸å…³ç¨‹åº¦ï¼ŒéªŒè¯å›å¤æ˜¯å¦ç›´æ¥é’ˆå¯¹ç”¨æˆ·çš„æŸ¥è¯¢ã€‚
3. **ç­”æ¡ˆè¯­ä¹‰ç›¸ä¼¼åº¦**ï¼šé‡åŒ–ç”Ÿæˆçš„ç­”æ¡ˆä¸é¢„æœŸçš„â€œç†æƒ³â€ç­”æ¡ˆä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œè¡¨æ˜ç”Ÿæˆçš„å†…å®¹åœ¨è¯­ä¹‰ä¸Šä¸é¢„æœŸå›å¤ä¸€è‡´ã€‚
4. **ç­”æ¡ˆæ­£ç¡®æ€§**ï¼šä¾§é‡äºäº‹å®æ ¸æŸ¥ï¼Œè¯„ä¼°ç”Ÿæˆç­”æ¡ˆçš„äº‹å®å‡†ç¡®æ€§ã€‚

åœ¨è¯„ä¼°è®¾ç½®ä¸­å¯ä»¥ä½¿ç”¨è¿™äº›æŒ‡æ ‡çš„å­é›†æˆ–å…¨éƒ¨ã€‚åœ¨æˆ‘ä»¬çš„ LLM-Twin RAG åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é’ˆå¯¹æ£€ç´¢å’Œç”Ÿæˆæ¨¡å—çš„ 6 é¡¹æŒ‡æ ‡ï¼š

* ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ã€å¬å›ç‡ã€ç›¸å…³æ€§å’Œå®ä½“å¬å›ç‡ â€” ç”¨äº **æ£€ç´¢**ã€‚
* ç­”æ¡ˆç›¸å…³æ€§å’Œç­”æ¡ˆè¯­ä¹‰ç›¸ä¼¼åº¦ â€” ç”¨äº **ç”Ÿæˆ**ã€‚

## RAGAs è¯„ä¼°æ ¼å¼

ä¸ºäº†è¯„ä¼° RAG ç®¡é“ï¼ŒRAGAs æœŸæœ›ä»¥ä¸‹æ•°æ®é›†æ ¼å¼ï¼š

```python
question       : ç”¨æˆ·æŸ¥è¯¢ï¼Œè¿™æ˜¯æˆ‘ä»¬ RAG çš„è¾“å…¥ã€‚
answer         : æ ¹æ®æŸ¥è¯¢ + ä¸Šä¸‹æ–‡æç¤ºä» RAG ç®¡é“ç”Ÿæˆçš„ç­”æ¡ˆã€‚
contexts       : ä»çŸ¥è¯†åº“ï¼ˆå‘é‡æ•°æ®åº“ï¼‰æ£€ç´¢çš„ä¸Šä¸‹æ–‡ã€‚
ground_truths  : é—®é¢˜çš„çœŸå®ç­”æ¡ˆã€‚

[æ³¨æ„] : ä»…åœ¨ä½¿ç”¨ ContextRecall æŒ‡æ ‡æ—¶éœ€è¦ `ground_truths` å­—æ®µã€‚
```

> ğŸ““ æ‰€æœ‰åˆ—å‡ºçš„ RAGAs æŒ‡æ ‡éƒ½ä½¿ç”¨ `question`ã€`answer` å’Œ `contexts` å­—æ®µã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå”¯ä¸€éœ€è¦ `ground_truths` å­—æ®µçš„æŒ‡æ ‡æ˜¯ **ä¸Šä¸‹æ–‡å¬å›ç‡**ã€‚å› ä¸ºå®ƒè¡¡é‡çš„æ˜¯å›ç­”é—®é¢˜æ‰€éœ€çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯æ˜¯å¦éƒ½ä»å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢åˆ°äº†ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¸º RAGAs è®¾ç½®æ•°æ®é›†çš„å¿«é€Ÿç¤ºä¾‹ï¼š

```python
from datasets import Dataset

questions= ["åŸƒè²å°”é“å¡”æ˜¯ä»€ä¹ˆæ—¶å€™å»ºé€ çš„ï¼Œå®ƒæœ‰å¤šé«˜ï¼Ÿ"],
answers= ["æˆªè‡³æˆ‘ä¸Šæ¬¡æ›´æ–°ï¼Œå³2023å¹´4æœˆï¼ŒåŸƒè²å°”é“å¡”å»ºäº1889å¹´ï¼Œé«˜324ç±³"]
contexts= [
   "åŸƒè²å°”é“å¡”æ˜¯è®¿é—®æ³•å›½å·´é»æ—¶æœ€å¸å¼•äººçš„çºªå¿µç¢‘ä¹‹ä¸€ã€‚å®ƒäº1889å¹´ä½œä¸º1889å¹´ä¸–ç•Œåšè§ˆä¼šçš„å…¥å£æ‹±é—¨å»ºé€ ï¼Œé«˜è¾¾324ç±³ã€‚"
  ]
ground_truths=[
    ["åŸƒè²å°”é“å¡”å»ºäº1889å¹´ï¼Œé«˜è¾¾324ç±³ã€‚"]
]

sample = {
  "question": questions,
  "answer": answers,
  "contexts": contexts,
  "ground_truths": ground_truths
}

eval_dataset = Dataset.from_dict(sample)
```
æ•°æ®é›†çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

```python
#> print(eval_dataset)
Dataset({
    features: ['question', 'answer', 'contexts', 'ground_truths'],
    num_rows: 1
})
```
åˆ›å»ºæ•°æ®é›†åï¼ŒRAGAs éœ€è¦ä¸€ç»„æŒ‡æ ‡ä¼ é€’ç»™è¯„ä¼°æ–¹æ³•ï¼š

```python
from ragas import evaluate
from ragas.metrics import (
    answer_similarity,
    context_relevancy,
)

scores = evaluate(
    dataset=eval_dataset,
    metrics=[context_recall, answer_similarity]
)

# åˆ†æ•°å°†æ˜¯ä¸€ä¸ªè¿™ç§æ ¼å¼çš„å­—å…¸
# scores = {
#    "context_recall": 0.95,
#    "answer_similarity": 0.98
# }
```
ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†ä½¿ç”¨ RAGAs æ‰€éœ€çš„å‰ææ¡ä»¶ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¯¥æ¡†æ¶å¦‚ä½•åº”ç”¨äºæˆ‘ä»¬çš„ LLM-Twin RAG è¯„ä¼°ç”¨ä¾‹ã€‚

# å¦‚ä½•è¯„ä¼°æˆ‘ä»¬çš„RAGåº”ç”¨ï¼Ÿ

åœ¨è¿™ä¸€è¯„ä¼°é˜¶æ®µï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨LLM Twinç³»ç»Ÿè®¾è®¡çš„è¿™ä¸€éƒ¨åˆ†ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*gA_XvdKWPGEUQn_GWAFpuA.png)

**å·¥ä½œæµç¨‹æ¦‚è§ˆï¼š**
1. å®šä¹‰è¯„ä¼°æç¤ºæ¨¡æ¿
2. å®šä¹‰ç”¨æˆ·æŸ¥è¯¢
3. ä»å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢ä¸ç”¨æˆ·æŸ¥è¯¢ç›¸å…³çš„ä¸Šä¸‹æ–‡
4. æ ¼å¼åŒ–æç¤ºå¹¶ä¼ é€’ç»™LLMæ¨¡å‹
5. æ•è·å›ç­”ï¼Œå¹¶ä½¿ç”¨æŸ¥è¯¢/ä¸Šä¸‹æ–‡å‡†å¤‡è¯„ä¼°æ•°æ®æ ·æœ¬
6. ä½¿ç”¨RAGAsè¿›è¡Œè¯„ä¼°
7. æ„å»ºè¯„ä¼°é“¾ï¼Œé™„åŠ å…ƒæ•°æ®ï¼Œå¹¶è®°å½•åˆ°CometML

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*lbJ7M1Hpmck-oQLr02NanA.png)

ğŸ—’ åœ¨æ·±å…¥å®ç°ä¹‹å‰ï¼Œä¸€ä¸ªæœ‰è¶£çš„ç»†èŠ‚æ˜¯ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿LLM-Twinæ¨¡ä»¿æˆ‘ä»¬çš„å†™ä½œé£æ ¼ã€‚

å¯¹äºè¿™ä¸ªç‰¹å®šçš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢çš„**ä¸Šä¸‹æ–‡**ä½œä¸ºè¯„ä¼°æ—¶çš„çœŸå®ä¾æ®ã€‚

**ä¸ºä»€ä¹ˆâ“**

ç”±äºæˆ‘ä»¬å·²ç»å°†æˆ‘ä»¬çš„å†™ä½œï¼ˆå¸–å­/æ–‡ç« /ä»£ç ï¼‰å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œå®ƒä»¬å¯èƒ½**æ‰®æ¼”åŒé‡è§’è‰²**ï¼Œæ—¢æ˜¯ä¼ é€’ç»™LLMç”¨äºç”Ÿæˆçš„`ä¸Šä¸‹æ–‡`ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è¯„ä¼°è¿‡ç¨‹ä¸­ä¸RAGå“åº”è¿›è¡Œæ¯”è¾ƒçš„`çœŸå®ä¾æ®`ã€‚

è€ƒè™‘åˆ°è¿™ä¸€ç»†èŠ‚ï¼Œç°åœ¨è®©æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªè“å›¾è¿›è¡Œå®ç°ï¼š

1. æˆ‘ä»¬å°†å›é¡¾æç¤ºæ¨¡æ¿
2. æˆ‘ä»¬å°†å‡†å¤‡ç”¨äºè¯„ä¼°çš„`æŸ¥è¯¢/å“åº”/ä¸Šä¸‹æ–‡`è´Ÿè½½
3. ä½¿ç”¨RAGAsè¿›è¡Œè¯„ä¼°
4. åœ¨CometMLä¸Šç›‘æ§ä¸€åˆ‡

**ç”Ÿæˆæç¤ºæ¨¡æ¿**

```python
class InferenceTemplate(BasePromptTemplate):
    simple_prompt: str = """You are an AI language model assistant. Your task is to generate a cohesive and concise response to the user question.
    Question: {question}
    """

    rag_prompt: str = """ You are a specialist in technical content writing. Your task is to create technical content based on a user query given a specific context 
    with additional information consisting of the user's previous writings and his knowledge.
    
    Here is a list of steps that you need to follow in order to solve this task:
    Step 1: You need to analyze the user provided query : {question}
    Step 2: You need to analyze the provided context and how the information in it relates to the user question: {context}
    Step 3: Generate the content keeping in mind that it needs to be as cohesive and concise as possible related to the subject presented in the query and similar to the users writing style and knowledge presented in the context.
    """

    def create_template(self, enable_rag: bool = True) -> PromptTemplate:
        if enable_rag is True:
            return PromptTemplate(
                template=self.rag_prompt, input_variables=["question", "context"]
            )

        return PromptTemplate(template=self.simple_prompt, input_variables=["question"])
```

è§£æè¿™ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬åœ¨`ç³»ç»Ÿæç¤º`ä¸­æŒ‡å®šäº†LLMæ¨¡å‹åº”è¯¥åœ¨***æ­¥éª¤1***ä¸­åˆ†æ`æŸ¥è¯¢`ï¼Œåœ¨***æ­¥éª¤2***ä¸­åˆ†ææ£€ç´¢åˆ°çš„`ä¸Šä¸‹æ–‡`ï¼Œå¹¶åœ¨***æ­¥éª¤3***ä¸­éµå¾ªç”ŸæˆæŒ‡ä»¤ã€‚

**å‡†å¤‡è¯„ä¼°è´Ÿè½½**

è®©æˆ‘ä»¬æŒ‰é¡ºåºéå†æ¯ä¸ªæ¨¡å—ã€‚æˆ‘ä»¬å·²ç»å®šä¹‰äº†**æç¤ºæ¨¡æ¿**ï¼Œå¹¶å°†`é—®é¢˜`å­—æ®µåˆ†é…ç»™è¾“å…¥æŸ¥è¯¢ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢ä¸Šä¸‹æ–‡æ ·æœ¬ã€‚

æ£€ç´¢é€»è¾‘å¦‚ä¸‹ï¼š

```python
# 1. å®ä¾‹åŒ–ä¸€ä¸ªä¸å‘é‡æ•°æ®åº“é€šä¿¡çš„VectorRetriever
retriever = VectorRetriever(query=query)
# 2. åˆå§‹è·å–Kä¸ªæ¡ç›®
hits = retriever.retrieve_top_k(
    k=settings.TOP_K, to_expand_to_n_queries=settings.EXPAND_N_QUERY
)
# 3. ä½¿ç”¨åæ£€ç´¢å¢å¼ºæŠ€æœ¯é‡æ–°æ’åºæ¡ç›®
context = retriever.rerank(hits=hits, keep_top_k=settings.KEEP_TOP_K)
# 4. æ›´æ–°ä¸Šä¸‹æ–‡
prompt_template_variables["context"] = context
prompt = prompt_template.format(question=query, context=context)
```

> è¦æ·±å…¥äº†è§£ä¸Šè¿°ä»£ç ä¸­æ­¥éª¤3æåˆ°çš„é‡æ–°æ’åºæŠ€æœ¯ï¼Œè¯·ç¡®ä¿æŸ¥çœ‹ğŸ““ [**ç¬¬5è¯¾**](https://readmedium.com/the-4-advanced-rag-algorithms-you-must-know-to-implement-5d0c7f1199d2)

æ£€ç´¢åˆ°ä¸Šä¸‹æ–‡åï¼Œæ˜¯æ—¶å€™å°†æˆ‘ä»¬çš„æç¤ºä¼ é€’ç»™éƒ¨ç½²åœ¨[Qwak [2]](https://www.qwak.com/lp/end-to-end-mlops/?utm_source=medium&utm_medium=referral&utm_campaign=decodingml)ä¸Šçš„æ¨ç†ç®¡é“ï¼Œå¹¶è·å–LLMç”Ÿæˆå“åº”ã€‚

> è¦æ·±å…¥äº†è§£æ¨ç†ç®¡é“æ˜¯å¦‚ä½•æ„å»ºå’Œéƒ¨ç½²çš„ï¼Œè¯·æŸ¥çœ‹ğŸ““ [**ç¬¬9è¯¾**](https://readmedium.com/architect-scalable-and-cost-effective-llm-rag-inference-pipelines-73b94ef82a99)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æœ‰è¯„ä¼°å—ä»£ç ï¼š

```python
if enable_evaluation is True:
    if enable_rag:
        st_time = time.time_ns()
        rag_eval_scores = evaluate_w_ragas(
            query=query, output=answer, context=context
        )
        en_time = time.time_ns()
        self._timings["evaluation_rag"] = (en_time - st_time) / 1e9
    st_time = time.time_ns()
    llm_eval = evaluate_llm(query=query, output=answer)
    en_time = time.time_ns()
    self._timings["evaluation_llm"] = (en_time - st_time) / 1e9
    evaluation_result = {
        "llm_evaluation": "" if not llm_eval else llm_eval,
        "rag_evaluation": {} if not rag_eval_scores else rag_eval_scores,
    }
else:
    evaluation_result = None
```

ä»è¿™ä¸€å®ç°ä¸­è·å¾—çš„å…³é”®è§è§£ï¼š

* æˆ‘ä»¬åº”ç”¨äº†ç¬¬8è¯¾ä¸­æè¿°çš„LLMè¯„ä¼°é˜¶æ®µï¼Œä»¥è¯„ä¼°`(æŸ¥è¯¢,å“åº”)`å¯¹ã€‚
* æˆ‘ä»¬åº”ç”¨äº†RAGè¯„ä¼°é˜¶æ®µï¼Œä»¥è¯„ä¼°`(æŸ¥è¯¢,å“åº”,ä¸Šä¸‹æ–‡)`å¯¹ã€‚
* æˆ‘ä»¬ä½¿ç”¨`_timings`å­—å…¸æ¥è·Ÿè¸ªæ‰§è¡ŒæŒç»­æ—¶é—´ï¼Œä»¥è¿›è¡Œæ€§èƒ½åˆ†æã€‚

æ ¸å¿ƒRAGAsè¯„ä¼°åŠŸèƒ½åœ¨`evaluate_w_ragas`æ–¹æ³•ä¸­å¤„ç†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```python
from ragas.metrics import (
    answer_correctness,
    answer_similarity,
    context_entity_recall,
    context_recall,
    context_relevancy,
    context_utilization,
)

METRICS = [
    context_utilization,
    context_relevancy,
    context_recall,
    answer_similarity,
    context_entity_recall,
    answer_correctness,
]

def evaluate_w_ragas(query: str, context: list[str], output: str) -> DataFrame:
    """
    ä½¿ç”¨RAGASè¯„ä¼°RAGï¼ˆæŸ¥è¯¢,ä¸Šä¸‹æ–‡,å“åº”ï¼‰
    """
    data_sample = {
        "question": [query],  # é—®é¢˜ä½œä¸ºåºåˆ—(str)
        "answer": [output],  # å›ç­”ä½œä¸ºåºåˆ—(str)
        "contexts": [context],  # ä¸Šä¸‹æ–‡ä½œä¸ºåºåˆ—(str)
        "ground_truth": [context],  # çœŸå®ä¾æ®ä½œä¸ºåºåˆ—(str)
    }

    oai_model = ChatOpenAI(
        model=settings.OPENAI_MODEL_ID,
        api_key=settings.OPENAI_API_KEY,
    )
    embd_model = HuggingfaceEmbeddings(model=settings.EMBEDDING_MODEL_ID)
    dataset = Dataset.from_dict(data_sample)
    score = evaluate(
        llm=oai_model,
        embeddings=embd_model,
        dataset=dataset,
        metrics=METRICS,
    )

    return score
```

**éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼š**

* æˆ‘ä»¬ä½¿ç”¨`data_sample`å­—å…¸å‡†å¤‡è¯„ä¼°æ•°æ®é›†ã€‚
* æˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ªè¿æ¥åˆ°OpenAI GPTæ¨¡å‹çš„è¿æ¥å™¨ï¼Œè¿™å°†ä½œä¸ºåº•å±‚LLMåœ¨**RAGAs**ä¸­æ‰§è¡Œè¯„ä¼°é€»è¾‘ã€‚æ¨¡å‹æ ‡ç­¾æ¥è‡ªè®¾ç½® = `gpt-4â€“1106-preview`
* æˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ªè¿æ¥åˆ°HuggingFaceEmbeddingsæ¨¡å‹çš„è¿æ¥å™¨ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸ä¹‹å‰åœ¨QDrantå‘é‡æ•°æ®åº“å®ä¾‹ä¸­å­˜å‚¨æ ·æœ¬æ—¶ä½¿ç”¨çš„ç›¸åŒçš„åµŒå…¥æ¨¡å‹ã€‚æ¨¡å‹æ ‡ç­¾æ¥è‡ªè®¾ç½® = `sentence-transformers/all-MiniLM-L6-v2`
* æˆ‘ä»¬ç»„åˆè´Ÿè½½å¹¶å°†å…¶ä¼ é€’ç»™`evaluate`æ–¹æ³•ã€‚

ä¸€æ—¦æ‰§è¡Œåˆ°è¾¾è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—éƒ¨åˆ†ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*cF-8bNDHGDaTjCAGrWWuHg.png)

ä¸€æ—¦è¯„ä¼°å®Œæˆï¼Œåœ¨`score`å˜é‡ä¸­æˆ‘ä»¬å°†æœ‰ä¸€ä¸ªè¿™ç§æ ¼å¼çš„å­—å…¸ï¼š

```python
score = {
  "context_utilization": float,  # ä¸Šä¸‹æ–‡å¯¹ç”Ÿæˆå›ç­”çš„å®ç”¨æ€§
  "context_relevancy": float,    # ä¸Šä¸‹æ–‡å¯¹ç»™å®šæŸ¥è¯¢çš„ç›¸å…³æ€§
  "context_recall": float,       # ç›¸å…³æ£€ç´¢ä¸Šä¸‹æ–‡çš„æ¯”ä¾‹
  "answer_similarity": float,    # è¯­ä¹‰ç›¸ä¼¼åº¦
  "answer_correctness": float,   # äº‹å®æ­£ç¡®æ€§
  "context_entity_recall": float,# ä¸Šä¸‹æ–‡ä¸­ç›¸å…³å®ä½“çš„å¬å›ç‡
}
```

åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬ä»¥é€æ­¥æ–¹å¼ç»„åˆå®Œæ•´çš„è¯„ä¼°é“¾ï¼Œå¹¶å°†å…¶è®°å½•åˆ°[Comet ML LLM [3]](https://www.comet.com/signup/?framework=llm&utm_source=decoding_ml&utm_medium=partner&utm_content=medium)è¿›è¡Œç›‘æ§ã€‚

# é«˜çº§æç¤ºé“¾ç›‘æ§

åœ¨åŸºäºLLMçš„åº”ç”¨ä¸­ï¼Œæç¤ºç›‘æ§è‡³å…³é‡è¦ï¼ŒåŸå› æœ‰å‡ ç‚¹ã€‚å®ƒæœ‰åŠ©äºç¡®ä¿å“åº”çš„è´¨é‡å’Œç›¸å…³æ€§ï¼Œä¿æŒç”¨æˆ·äº¤äº’çš„å‡†ç¡®æ€§å’Œè¿è´¯æ€§ï¼ŒåŒæ—¶å…è®¸ç»´æŠ¤é¡¹ç›®çš„MLå·¥ç¨‹å¸ˆåŠæ—©å‘ç°å¹¶ç¼“è§£åè§æˆ–å¹»è§‰ï¼Œå¹¶ç€æ‰‹ä¿®å¤å®ƒä»¬ã€‚

> ğŸ““ åœ¨[ç¬¬8è¯¾](https://readmedium.com/best-practices-when-evaluating-fine-tuned-llms-47f02f5164c2)ä¸­ï¼Œæˆ‘ä»¬æ›´è¯¦ç»†åœ°æè¿°äº†æç¤ºç›‘æ§çš„ä¼˜åŠ¿ã€‚

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»å¦‚ä½•æ„å»ºç«¯åˆ°ç«¯çš„é“¾å¹¶å°†å®ƒä»¬è®°å½•åˆ°[Comet ML LLM [3]](https://www.comet.com/signup/?framework=llm&utm_source=decoding_ml&utm_medium=partner&utm_content=medium)ã€‚è®©æˆ‘ä»¬æ·±å…¥ä»£ç ï¼Œæè¿°é“¾ç”±å“ªäº›ç»„ä»¶ç»„æˆã€‚

**æ­¥éª¤1ï¼šå®šä¹‰é“¾çš„å¼€å§‹** è¿™é‡Œæˆ‘ä»¬æŒ‡å®šè¦ä»CometMLè®°å½•æ­¤é“¾çš„`project, workspace`ï¼Œå¹¶å°†å…¶`inputs`è®¾ç½®ä¸ºæ ‡è®°å¼€å§‹ã€‚

```python
import comet_llm

comet_llm.init([project])
comet_llm.start_chain(
  inputs={'user_query' : [our query]},
  project=[comet-llm-project],
  api_key=[comet-llm-api-key],
  workspace=[comet-llm-ws]
)
```

**æ­¥éª¤2ï¼šå®šä¹‰é“¾çš„é˜¶æ®µ** æˆ‘ä»¬ä½¿ç”¨å¤šä¸ª`Span (comet_llm.Span)`å¯¹è±¡æ¥å®šä¹‰é“¾çš„é˜¶æ®µã€‚åœ¨`Span`å¯¹è±¡å†…éƒ¨ï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ï¼š

* `category` â€” ä½œä¸ºç»„é”®ã€‚
* `name` â€” å½“å‰é“¾æ­¥éª¤çš„åç§°ï¼ˆå°†å‡ºç°åœ¨CometML UIä¸­ï¼‰
* `inputs` â€” ä½œä¸ºå­—å…¸ï¼Œç”¨äºä¸ä¹‹å‰çš„é“¾æ­¥éª¤ï¼ˆSpanï¼‰å…³è”
* `outputs` â€” ä½œä¸ºå­—å…¸ï¼Œå®šä¹‰æ­¤é“¾æ­¥éª¤çš„è¾“å‡ºã€‚

```python
with comet_llm.Span(
  "category"="RAG Evaluation",
  "name"="ragas_eval",
  "inputs"={"query": [our_query], "context": [our_context], "answers": [llm_answers]}
) as span:
  span.set_outputs(outputs={"rag-eval-scores" : [ragas_scores]})
```

**æ­¥éª¤3ï¼šå®šä¹‰é“¾çš„ç»“æŸ** æœ€åä¸€æ­¥ï¼Œåœ¨å¯åŠ¨é“¾å¹¶é™„åŠ é“¾é˜¶æ®µä¹‹åï¼Œæ˜¯æ ‡è®°é“¾çš„ç»“æŸå¹¶è¿”å›å“åº”ã€‚

```python
comet_llm.end_chain(outputs={"response": [our-rag-response]})
```

ç°åœ¨æˆ‘ä»¬å·²ç»ç†è§£äº†[Comet ML LLM [3]](https://www.comet.com/signup/?framework=llm&utm_source=decoding_ml&utm_medium=partner&utm_content=medium)é“¾ç›‘æ§èƒŒåçš„é€»è¾‘ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®é™…çš„å®ç°æ˜¯ä»€ä¹ˆæ ·çš„ï¼š

```python
# == å¯åŠ¨é“¾ ==
comet_llm.init(project=f"{settings.COMET_PROJECT}-monitoring")
comet_llm.start_chain(
    inputs={"user_query": query},
    project=f"{settings.COMET_PROJECT}-monitoring",
    api_key=settings.COMET_API_KEY,
    workspace=settings.COMET_WORKSPACE,
)

# == é“¾æ­¥éª¤ ==
with comet_llm.Span(
    category="Vector Retrieval",
    name="retrieval_step",
    inputs={"user_query": query},
) as span:
    span.set_outputs(outputs={"retrieved_context": context})

with comet_llm.Span(
    category="LLM Generation",
    name="generation_step",
    inputs={"user_query": query},
) as span:
    span.set_outputs(outputs={"generation": llm_gen})

with comet_llm.Span(
    category="Evaluation",
    name="llm_eval_step",
    inputs={"query": llm_gen, "user_query": query},
    metadata={"model_used": settings.OPENAI_MODEL_ID},
) as span:
    span.set_outputs(outputs={"llm_eval_result": llm_eval_output})

with comet_llm.Span(
    category="Evaluation",
    name="rag_eval_step",
    inputs={
        "user_query": query,
        "retrieved_context": context,
        "llm_gen": llm_gen,
    },
    metadata={
        "model_used": settings.OPENAI_MODEL_ID,
        "embd_model": settings.EMBEDDING_MODEL_ID,
        "eval_framework": "RAGAS",
    },
) as span:
    span.set_outputs(outputs={"rag_eval_scores": rag_eval_scores})

# == ç»“æŸé“¾ ==
comet_llm.end_chain(outputs={"response": llm_gen})
```

> ğŸ““ å®Œæ•´çš„é“¾ç›‘æ§å®ç°ï¼Œè¯·æŸ¥çœ‹[PromptMonitoringManager](https://github.com/decodingml/llm-twin-course/blob/main/course/module-5/monitoring/prompt_monitoring.py)ç±»ã€‚

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œ`Span`è¿˜æœ‰ä¸€ä¸ª`metadata`å­—æ®µï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥è®°å½•ä»…å¯¹å½“å‰é“¾æ­¥éª¤é‡è¦çš„é¢å¤–æ•°æ®ã€‚

ä¾‹å¦‚ï¼Œåœ¨`rag_eval_step`ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä½¿ç”¨çš„è¯„ä¼°æ¡†æ¶å’Œæ¨¡å‹ç±»å‹ã€‚åœ¨CometML UIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é™„åŠ çš„å…ƒæ•°æ®ã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*iL4Sg2aZFqK-dr_OMtv1tw.png)

ä¸€æ—¦è¯„ä¼°è¿‡ç¨‹å®Œæˆï¼Œå¹¶ä¸”é“¾æˆåŠŸè®°å½•åˆ°[Comet ML LLM [3]](https://www.comet.com/signup/?framework=llm&utm_source=decoding_ml&utm_medium=partner&utm_content=medium)ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æœŸæœ›çœ‹åˆ°çš„å†…å®¹ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*DZczA3rHrQCctzFG75_uWQ.png)

> å¦‚æœæ‚¨æƒ³å›é¡¾æˆ‘ä»¬å¦‚ä½•ä»…è¯„ä¼°LLMæ¨¡å‹ï¼Œè¯·ç¡®ä¿æŸ¥çœ‹ğŸ““[**ç¬¬8è¯¾**](https://readmedium.com/best-practices-when-evaluating-fine-tuned-llms-47f02f5164c2)ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­è¿›è¡Œäº†è¯¦ç»†æè¿°ã€‚

å¦‚æœæˆ‘ä»¬æƒ³æŸ¥çœ‹RAGè¯„ä¼°åˆ†æ•°ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*e7qDDAuUiVoE1V9IIBVqzA.png)

# ç»“è®º

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†LLM Twin **å…è´¹è¯¾ç¨‹**çš„**ç¬¬10è¯¾**ã€‚

æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨åä¸ºRAGAsçš„å¼ºå¤§æ¡†æ¶æ¥æè¿°LLM-Twin RAGè¯„ä¼°å·¥ä½œæµç¨‹ã€‚æˆ‘ä»¬è§£é‡Šäº†æ‰€ä½¿ç”¨çš„æŒ‡æ ‡ã€å¦‚ä½•å®ç°è¯„ä¼°åŠŸèƒ½ä»¥åŠå¦‚ä½•æ„å»ºè¯„ä¼°æ•°æ®é›†ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å±•ç¤ºäº†å¦‚ä½•åœ¨[Comet ML LLM [3]](https://www.comet.com/signup/?framework=llm&utm_source=decoding_ml&utm_medium=partner&utm_content=medium)ä¸Šæœ‰æ•ˆç›‘æ§å…·æœ‰å¤šä¸ªæ‰§è¡Œæ­¥éª¤çš„é“¾ï¼Œå¦‚ä½•é™„åŠ å…ƒæ•°æ®ï¼Œå¦‚ä½•åˆ†ç»„é“¾æ­¥éª¤ç­‰ã€‚

**é€šè¿‡å®Œæˆç¬¬10è¯¾**ï¼Œæ‚¨å·²ç»å¯¹å¦‚ä½•ä½¿ç”¨RAGAsæ„å»ºå®Œæ•´çš„RAGè¯„ä¼°ç®¡é“æœ‰äº†å¾ˆå¥½çš„ç†è§£ã€‚æ‚¨å­¦ä¹ äº†å¯ç”¨çš„æ£€ç´¢ä¸ç”Ÿæˆç‰¹å®šæŒ‡æ ‡ä»¥åŠå°†å¤§å‹LLMé“¾è®°å½•åˆ°[Comet ML LLM [3]](https://www.comet.com/signup/?framework=llm&utm_source=decoding_ml&utm_medium=partner&utm_content=medium)æ‰€éœ€çš„æ‰€æœ‰ç»†èŠ‚ã€‚

åœ¨**ç¬¬11è¯¾**ä¸­ï¼Œæˆ‘ä»¬å°†å›é¡¾å¹¶å¤ä¹ LLM-Twinè¯¾ç¨‹çš„æ•´ä¸ªå·¥ä½œæµç¨‹ï¼Œæè¿°æ¯ä¸ªæ¨¡å—å¹¶æåŠæ‚¨è·Ÿè¿›å¹¶**å…è´¹æ„å»ºä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„RAGåº”ç”¨ç¨‹åº**æ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œåˆ©ç”¨æˆ‘ä»¬ä»ç»éªŒä¸­è·å¾—çš„æœ€å¥½è§è§£ã€‚*æœŸå¾…åœ¨é‚£é‡Œä¸æ‚¨ç›¸è§ï¼*

*ğŸ”— **æŸ¥çœ‹** [GitHubä¸Šçš„ä»£ç ](https://github.com/decodingml/llm-twin-course) [1] å¹¶ç»™æˆ‘ä»¬ä¸€ä¸ªâ­ï¸æ”¯æŒ*

# å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿ

*åŠ å…¥[**è§£ç MLé€šè®¯**](https://decodingml.substack.com/)ï¼Œè·å–å…³äºè®¾è®¡ã€ç¼–ç åŠéƒ¨ç½²**ç”Ÿäº§çº§MLä¸MLOpsç³»ç»Ÿ**çš„**å®æˆ˜ç»éªŒåˆ†äº«**ã€‚æ¯å‘¨æ›´æ–°ï¼Œå®Œå…¨å…è´¹* â†“

# å‚è€ƒæ–‡çŒ®

[1] [LLM Twin Github ä»“åº“](https://github.com/decodingml/llm-twin-course)ï¼Œ2024ï¼ŒDecoding ML GitHub ç»„ç»‡

[2] [Qwak](https://www.qwak.com/lp/end-to-end-mlops/?utm_source=medium&utm_medium=referral&utm_campaign=decodingml)ï¼Œ2024ï¼ŒThe Qwak.ai å¹³å°ç™»å½•é¡µé¢

[3] [Comet ML LLM](https://www.comet.com/signup/?utm_source=decoding_ml&utm_medium=partner&utm_content=medium)ï¼ŒThe Comet ML LLM å¹³å°

[4] [RAGAs æŒ‡æ ‡](https://docs.ragas.io/en/latest/concepts/metrics/index.html)ï¼ŒThe RAGAs æ¡†æ¶æŒ‡æ ‡æ–‡æ¡£

[5] [RAGAs](https://github.com/explodinggradients/ragas)ï¼ŒThe RAGAs æ¡†æ¶ Github ä»“åº“

[6] [RAGAs è®ºæ–‡](https://arxiv.org/abs/2309.15217)ï¼Œ2023ï¼ŒThe RAGAs Arxiv è®ºæ–‡
