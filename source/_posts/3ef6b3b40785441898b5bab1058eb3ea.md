
---
cover: https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*EbBEUEZk6YN4aeST0gJu3Q.png
date: '2024-03-16 07:25:32'
tags:
  - è¡¨æ ¼è§£æ
  - RAG
  - å¼€æºè§£å†³æ–¹æ¡ˆ
title: é«˜çº§RAG 07æ¢ç´¢è¡¨æ ¼çš„RAGåº”ç”¨

---


## å…³é”®æŠ€æœ¯ã€ç°æœ‰å¼€æºæ–¹æ¡ˆï¼Œæå‡ºå¹¶å®ç°æ–°æ–¹æ¡ˆ

å®ç°RAGé¢ä¸´æŒ‘æˆ˜ï¼Œ**å°¤å…¶æ˜¯åœ¨æœ‰æ•ˆè§£æå’Œç†è§£éç»“æ„åŒ–æ–‡æ¡£ä¸­çš„è¡¨æ ¼æ–¹é¢ã€‚** å¯¹äºæ‰«ææ–‡æ¡£æˆ–å›¾åƒæ ¼å¼çš„æ–‡æ¡£ï¼Œè¿™ä¸€æŒ‘æˆ˜å°¤ä¸ºå›°éš¾ã€‚è¿™äº›æŒ‘æˆ˜è‡³å°‘åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š

* æ‰«ææ–‡æ¡£æˆ–å›¾åƒæ–‡æ¡£çš„å¤æ‚æ€§ï¼Œå¦‚å…¶å¤šæ ·åŒ–çš„ç»“æ„ã€åŒ…å«éæ–‡æœ¬å…ƒç´ ä»¥åŠæ‰‹å†™ä¸å°åˆ·å†…å®¹çš„æ··åˆï¼Œç»™è‡ªåŠ¨å‡†ç¡®æå–è¡¨æ ¼ä¿¡æ¯å¸¦æ¥äº†æŒ‘æˆ˜ã€‚**è§£æä¸å‡†ç¡®ä¼šç ´åè¡¨æ ¼ç»“æ„**ï¼Œä½¿ç”¨ä¸å®Œæ•´çš„è¡¨æ ¼è¿›è¡ŒåµŒå…¥ä¸ä»…æ— æ³•æ•æ‰è¡¨æ ¼çš„è¯­ä¹‰ä¿¡æ¯ï¼Œè¿˜å®¹æ˜“ç ´åRAGçš„ç»“æœã€‚
* **å¦‚ä½•æå–è¡¨æ ¼æ ‡é¢˜å¹¶æœ‰æ•ˆå…³è”åˆ°å„è‡ªçš„è¡¨æ ¼ã€‚**
* **å¦‚ä½•è®¾è®¡ç´¢å¼•ç»“æ„ä»¥æœ‰æ•ˆå­˜å‚¨è¡¨æ ¼çš„è¯­ä¹‰ä¿¡æ¯ã€‚**

æœ¬æ–‡é¦–å…ˆä»‹ç»RAGä¸­ç®¡ç†è¡¨æ ¼çš„å…³é”®æŠ€æœ¯ï¼Œç„¶åå›é¡¾ä¸€äº›ç°æœ‰çš„å¼€æºè§£å†³æ–¹æ¡ˆï¼Œæœ€åæå‡ºå¹¶å®ç°ä¸€ä¸ªæ–°æ–¹æ¡ˆã€‚

# å…³é”®æŠ€æœ¯

## è¡¨æ ¼è§£æ

è¯¥æ¨¡å—çš„ä¸»è¦åŠŸèƒ½æ˜¯ä»éç»“æ„åŒ–æ–‡æ¡£æˆ–å›¾åƒä¸­å‡†ç¡®æå–è¡¨æ ¼ç»“æ„ã€‚

é™„åŠ åŠŸèƒ½ï¼šæœ€å¥½èƒ½æå–ç›¸åº”çš„è¡¨æ ¼æ ‡é¢˜ï¼Œå¹¶æ–¹ä¾¿å¼€å‘è€…å°†è¡¨æ ¼æ ‡é¢˜ä¸è¡¨æ ¼å…³è”ã€‚

æ ¹æ®æˆ‘ç›®å‰çš„ç†è§£ï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼š



**(a).** **åˆ©ç”¨å¤šæ¨¡æ€LLM**ï¼Œå¦‚[GPT-4V](https://openai.com/research/gpt-4v-system-card)ï¼Œæ¥è¯†åˆ«è¡¨æ ¼å¹¶ä»æ¯ä¸ªPDFé¡µé¢ä¸­æå–ä¿¡æ¯ã€‚

* è¾“å…¥ï¼šå›¾åƒæ ¼å¼çš„PDFé¡µé¢
* è¾“å‡ºï¼šJSONæˆ–å…¶ä»–æ ¼å¼çš„è¡¨æ ¼ã€‚å¦‚æœå¤šæ¨¡æ€LLMæ— æ³•æå–è¡¨æ ¼æ•°æ®ï¼Œåˆ™åº”æ€»ç»“å›¾åƒå¹¶è¿”å›æ€»ç»“ã€‚

**(b).** **åˆ©ç”¨ä¸“ä¸šè¡¨æ ¼æ£€æµ‹æ¨¡å‹**ï¼Œå¦‚[Table Transformer](https://github.com/microsoft/table-transformer)ï¼Œæ¥è¯†åˆ«è¡¨æ ¼ç»“æ„ã€‚

* è¾“å…¥ï¼šå›¾åƒæ ¼å¼çš„PDFé¡µé¢
* è¾“å‡ºï¼šå›¾åƒæ ¼å¼çš„è¡¨æ ¼

**(c).** **ä½¿ç”¨å¼€æºæ¡†æ¶**ï¼Œå¦‚[unstructured](https://unstructured-io.github.io/unstructured/best_practices/table_extraction_pdf.html)ç­‰ï¼Œè¿™äº›æ¡†æ¶ä¹Ÿé‡‡ç”¨å¯¹è±¡æ£€æµ‹æ¨¡å‹ï¼ˆunstructuredçš„è¡¨æ ¼æ£€æµ‹è¿‡ç¨‹è¯¦è§[æœ¬æ–‡](https://pub.towardsai.net/advanced-rag-02-unveiling-pdf-parsing-b84ae866344e)ï¼‰ã€‚è¿™äº›æ¡†æ¶å…è®¸å¯¹æ•´ä¸ªæ–‡æ¡£è¿›è¡Œå…¨é¢è§£æï¼Œå¹¶ä»è§£æç»“æœä¸­æå–ä¸è¡¨æ ¼ç›¸å…³çš„å†…å®¹ã€‚

* è¾“å…¥ï¼šPDFæˆ–å›¾åƒæ ¼å¼çš„æ–‡æ¡£
* è¾“å‡ºï¼šä»æ•´ä¸ªæ–‡æ¡£çš„è§£æç»“æœä¸­è·å¾—çš„çº¯æ–‡æœ¬æˆ–HTMLæ ¼å¼çš„è¡¨æ ¼

**(d).** **ä½¿ç”¨ç«¯åˆ°ç«¯æ¨¡å‹**ï¼Œå¦‚[Nougat](https://github.com/facebookresearch/nougat)ã€[Donut](https://github.com/clovaai/donut/)ç­‰ï¼Œæ¥è§£ææ•´ä¸ªæ–‡æ¡£å¹¶æå–ä¸è¡¨æ ¼ç›¸å…³çš„å†…å®¹ã€‚è¿™ç§æ–¹æ³•ä¸éœ€è¦OCRæ¨¡å‹ã€‚

* è¾“å…¥ï¼šPDFæˆ–å›¾åƒæ ¼å¼çš„æ–‡æ¡£
* è¾“å‡ºï¼šä»æ•´ä¸ªæ–‡æ¡£çš„è§£æç»“æœä¸­è·å¾—çš„LaTeXæˆ–JSONæ ¼å¼çš„è¡¨æ ¼

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ— è®ºä½¿ç”¨å“ªç§æ–¹æ³•æå–è¡¨æ ¼ä¿¡æ¯ï¼Œéƒ½åº”åŒ…å«è¡¨æ ¼æ ‡é¢˜ã€‚å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¡¨æ ¼æ ‡é¢˜æ˜¯æ–‡æ¡£æˆ–è®ºæ–‡ä½œè€…å¯¹è¡¨æ ¼çš„ç®€è¦æè¿°ï¼Œå¯ä»¥å¤§è‡´æ¦‚æ‹¬æ•´ä¸ªè¡¨æ ¼ã€‚

åœ¨ä¸Šè¿°å››ç§æ–¹æ³•ä¸­ï¼Œæ–¹æ³•(d)å¯ä»¥æ–¹ä¾¿åœ°æ£€ç´¢è¡¨æ ¼æ ‡é¢˜ã€‚è¿™å¯¹å¼€å‘è€…æœ‰ç›Šï¼Œå› ä¸ºå®ƒå…è®¸ä»–ä»¬å°†è¡¨æ ¼æ ‡é¢˜ä¸è¡¨æ ¼å…³è”ã€‚è¿™ä¸€ç‚¹å°†åœ¨åç»­å®éªŒä¸­è¿›ä¸€æ­¥è§£é‡Šã€‚

## ç´¢å¼•ç»“æ„

æ ¹æ®ç´¢å¼•çš„ç»“æ„ï¼Œè§£å†³æ–¹æ¡ˆå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

**(e).** ä»…ç´¢å¼•å›¾åƒæ ¼å¼çš„è¡¨æ ¼ã€‚

**(f).** ä»…ç´¢å¼•çº¯æ–‡æœ¬æˆ–JSONæ ¼å¼çš„è¡¨æ ¼ã€‚

**(g).** ä»…ç´¢å¼•LaTeXæ ¼å¼çš„è¡¨æ ¼ã€‚

**(h).** ä»…ç´¢å¼•è¡¨æ ¼çš„æ‘˜è¦ã€‚

**(i).** å°åˆ°å¤§æˆ–æ–‡æ¡£æ‘˜è¦ç´¢å¼•ç»“æ„ï¼Œå¦‚å›¾2æ‰€ç¤ºã€‚

* å°å—å†…å®¹å¯ä»¥æ˜¯è¡¨æ ¼ä¸­æ¯ä¸€è¡Œçš„ä¿¡æ¯æˆ–è¡¨æ ¼çš„æ‘˜è¦ã€‚
* å¤§å—å†…å®¹å¯ä»¥æ˜¯å›¾åƒæ ¼å¼ã€çº¯æ–‡æœ¬æ ¼å¼æˆ–LaTeXæ ¼å¼çš„è¡¨æ ¼ã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*olPIDUHXulhN2KXdrnRzug.png)

å¦‚ä¸Šæ‰€è¿°ï¼Œè¡¨æ ¼æ‘˜è¦æ˜¯é€šå¸¸ä½¿ç”¨LLMç”Ÿæˆçš„ï¼š

* è¾“å…¥ï¼šå›¾åƒæ ¼å¼ã€æ–‡æœ¬æ ¼å¼æˆ–LaTeXæ ¼å¼çš„è¡¨æ ¼
* è¾“å‡ºï¼šè¡¨æ ¼æ‘˜è¦

## æ— éœ€è¡¨æ ¼è§£æã€ç´¢å¼•æˆ–RAGçš„ç®—æ³•

**æŸäº›ç®—æ³•æ— éœ€è¡¨æ ¼è§£æã€‚**

**(j).** å°†ç›¸å…³å›¾åƒï¼ˆPDFé¡µé¢ï¼‰å’Œç”¨æˆ·æŸ¥è¯¢å‘é€è‡³VQAæ¨¡å‹ï¼ˆå¦‚[DAN](https://arxiv.org/pdf/1611.00471.pdf)ç­‰ï¼‰æˆ–è·¨æ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå¹¶è¿”å›ç­”æ¡ˆã€‚

* éœ€ç´¢å¼•å†…å®¹ï¼šå›¾åƒæ ¼å¼çš„æ–‡æ¡£
* å‘é€è‡³VQAæ¨¡å‹æˆ–è·¨æ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹çš„å†…å®¹ï¼šæŸ¥è¯¢ + å¯¹åº”çš„**å›¾åƒå½¢å¼**é¡µé¢

**(k).** å°†**ç›¸å…³æ–‡æœ¬æ ¼å¼çš„PDFé¡µé¢**å’Œç”¨æˆ·æŸ¥è¯¢å‘é€è‡³å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œç„¶åè¿”å›ç­”æ¡ˆã€‚

* éœ€ç´¢å¼•å†…å®¹ï¼šæ–‡æœ¬æ ¼å¼çš„æ–‡æ¡£
* å‘é€è‡³å¤§å‹è¯­è¨€æ¨¡å‹çš„å†…å®¹ï¼šæŸ¥è¯¢ + å¯¹åº”çš„**æ–‡æœ¬æ ¼å¼**é¡µé¢

**(l).** å°†**ç›¸å…³å›¾åƒï¼ˆPDFé¡µé¢ï¼‰ã€æ–‡æœ¬ç‰‡æ®µå’Œç”¨æˆ·æŸ¥è¯¢**å‘é€è‡³è·¨æ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPT-4Vç­‰ï¼‰ï¼Œå¹¶ç›´æ¥è¿”å›ç­”æ¡ˆã€‚

* éœ€ç´¢å¼•å†…å®¹ï¼šå›¾åƒæ ¼å¼çš„æ–‡æ¡£å’Œæ–‡æœ¬æ ¼å¼çš„æ–‡æ¡£ç‰‡æ®µ
* å‘é€è‡³è·¨æ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹çš„å†…å®¹ï¼šæŸ¥è¯¢ + æ–‡æ¡£çš„å¯¹åº”å›¾åƒå½¢å¼ + å¯¹åº”çš„æ–‡æœ¬ç‰‡æ®µ

**æ­¤å¤–ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æ— éœ€ç´¢å¼•çš„æ–¹æ³•ï¼Œå¦‚å›¾3å’Œå›¾4æ‰€ç¤ºï¼š**

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*4B29FecUGOZgHP4ODiewIQ.png)

**(m).** é¦–å…ˆï¼Œé‡‡ç”¨(a)è‡³(d)ç±»åˆ«ä¸­çš„ä»»ä¸€æ–¹æ³•ï¼Œå°†æ–‡æ¡£ä¸­çš„æ‰€æœ‰è¡¨æ ¼è§£æä¸ºå›¾åƒæ ¼å¼ã€‚ç„¶åç›´æ¥å°†æ‰€æœ‰è¡¨æ ¼å›¾åƒå’Œç”¨æˆ·æŸ¥è¯¢å‘é€è‡³è·¨æ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPT-4Vç­‰ï¼‰å¹¶è¿”å›ç­”æ¡ˆã€‚

* éœ€ç´¢å¼•å†…å®¹ï¼šæ— 
* å‘é€è‡³è·¨æ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹çš„å†…å®¹ï¼šæŸ¥è¯¢ + æ‰€æœ‰è§£æåçš„è¡¨æ ¼ï¼ˆå›¾åƒæ ¼å¼ï¼‰

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*nLA10EAZ0bASg2d7iiAblA.png)

**(n).** ä½¿ç”¨(m)æå–çš„å›¾åƒæ ¼å¼è¡¨æ ¼ï¼Œç„¶ååˆ©ç”¨OCRæ¨¡å‹è¯†åˆ«è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ–‡æœ¬ï¼Œç›´æ¥å°†è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ–‡æœ¬å’Œç”¨æˆ·æŸ¥è¯¢å‘é€è‡³å¤§å‹è¯­è¨€æ¨¡å‹å¹¶ç›´æ¥è¿”å›ç­”æ¡ˆã€‚

* éœ€ç´¢å¼•å†…å®¹ï¼šæ— 
* å‘é€è‡³å¤§å‹è¯­è¨€æ¨¡å‹çš„å†…å®¹ï¼šç”¨æˆ·æŸ¥è¯¢ + è¡¨æ ¼å†…å®¹ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰

**å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›æ–¹æ³•ä¸ä¾èµ–äºRAGæµç¨‹ï¼š**

* ç¬¬ä¸€ç§æ–¹æ³•ä¸ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œé’ˆå¯¹ç‰¹å®šæ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œä½¿æ¨¡å‹ï¼ˆå¦‚BERTç±»å˜æ¢å™¨ï¼‰æ›´å¥½åœ°æ”¯æŒè¡¨æ ¼ç†è§£ä»»åŠ¡ï¼Œä¾‹å¦‚[TAPAS](https://aclanthology.org/2020.acl-main.398.pdf)ã€‚
* ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œé‡‡ç”¨é¢„è®­ç»ƒã€å¾®è°ƒæ–¹æ³•æˆ–æç¤ºï¼Œä½¿å¤§å‹è¯­è¨€æ¨¡å‹æ‰§è¡Œè¡¨æ ¼ç†è§£ä»»åŠ¡ï¼Œå¦‚[GPT4Table](https://arxiv.org/pdf/2305.13062.pdf)ã€‚

# ç°æœ‰å¼€æºè§£å†³æ–¹æ¡ˆ

ä¸Šä¸€èŠ‚æ€»ç»“å¹¶åˆ†ç±»äº† RAG ä¸­è¡¨æ ¼çš„å…³é”®æŠ€æœ¯ã€‚åœ¨æå‡ºæœ¬æ–‡å®ç°çš„è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¢è®¨ä¸€äº›å¼€æºè§£å†³æ–¹æ¡ˆã€‚

**LlamaIndex æå‡ºäº† [å››ç§æ–¹æ³•](https://docs.llamaindex.ai/en/stable/examples/multi_modal/multi_modal_pdf_tables.html)ï¼Œå…¶ä¸­å‰ä¸‰ç§ä½¿ç”¨äº†å¤šæ¨¡æ€æ¨¡å‹ã€‚**

1. æ£€ç´¢ç›¸å…³å›¾åƒï¼ˆPDF é¡µé¢ï¼‰å¹¶å‘é€ç»™ GPT-4V ä»¥å“åº”æŸ¥è¯¢ã€‚
2. å°†æ¯ä¸ª PDF é¡µé¢è§†ä¸ºå›¾åƒï¼Œè®© GPT-4V å¯¹æ¯ä¸ªé¡µé¢è¿›è¡Œå›¾åƒæ¨ç†ã€‚ä¸ºå›¾åƒæ¨ç†æ„å»ºæ–‡æœ¬å‘é‡å­˜å‚¨ç´¢å¼•ã€‚é’ˆå¯¹å›¾åƒæ¨ç†å‘é‡å­˜å‚¨æŸ¥è¯¢ç­”æ¡ˆã€‚
3. ä½¿ç”¨ Table Transformer ä»æ£€ç´¢åˆ°çš„å›¾åƒä¸­è£å‰ªè¡¨æ ¼ä¿¡æ¯ï¼Œç„¶åå°†è¿™äº›è£å‰ªåçš„å›¾åƒå‘é€ç»™ GPT-4V ä»¥å“åº”æŸ¥è¯¢ã€‚
4. å¯¹è£å‰ªåçš„è¡¨æ ¼å›¾åƒåº”ç”¨ OCRï¼Œå¹¶å°†æ•°æ®å‘é€ç»™ GPT4/GPT-3.5 ä»¥å›ç­”æŸ¥è¯¢ã€‚

æ ¹æ®æœ¬æ–‡çš„åˆ†ç±»ï¼š

* ç¬¬ä¸€ç§æ–¹æ³•ç±»ä¼¼äºæœ¬æ–‡çš„ **ç±»åˆ« (j)**ï¼Œä¸éœ€è¦è¡¨æ ¼è§£æã€‚ç„¶è€Œï¼Œç»“æœæ˜¾ç¤ºï¼Œå³ä½¿ç­”æ¡ˆåœ¨å›¾åƒä¸­ï¼Œä¹Ÿæ— æ³•äº§ç”Ÿæ­£ç¡®çš„ç­”æ¡ˆã€‚
* ç¬¬äºŒç§æ–¹æ³•æ¶‰åŠè¡¨æ ¼è§£æï¼Œå¯¹åº”äº **ç±»åˆ« (a)**ã€‚ç´¢å¼•å†…å®¹è¦ä¹ˆæ˜¯è¡¨æ ¼å†…å®¹ï¼Œè¦ä¹ˆæ˜¯æ ¹æ® GPT-4V è¿”å›çš„ç»“æœè¿›è¡Œæ€»ç»“ï¼Œè¿™å¯èƒ½å¯¹åº”äº **ç±»åˆ« (f) æˆ– (h)**ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ GPT-4V è¯†åˆ«è¡¨æ ¼å¹¶ä»å›¾åƒä¸­æå–å…¶å†…å®¹çš„èƒ½åŠ›ä¸ç¨³å®šï¼Œç‰¹åˆ«æ˜¯å½“å›¾åƒåŒ…å«è¡¨æ ¼ã€æ–‡æœ¬å’Œå…¶ä»–å›¾åƒçš„æ··åˆæ—¶ï¼Œè¿™åœ¨ PDF æ ¼å¼ä¸­å¾ˆå¸¸è§ã€‚
* ç¬¬ä¸‰ç§æ–¹æ³•ç±»ä¼¼äº **ç±»åˆ« (m)**ï¼Œä¸éœ€è¦ç´¢å¼•ã€‚
* ç¬¬å››ç§æ–¹æ³•ç±»ä¼¼äº **ç±»åˆ« (n)**ï¼Œä¹Ÿä¸éœ€è¦ç´¢å¼•ã€‚å…¶ç»“æœè¡¨æ˜ï¼Œç”±äºæ— æ³•ä»å›¾åƒä¸­æå–è¡¨æ ¼ä¿¡æ¯ï¼Œå¯¼è‡´äº§ç”Ÿäº†é”™è¯¯çš„ç­”æ¡ˆã€‚

é€šè¿‡æµ‹è¯•å‘ç°ï¼Œ**ç¬¬ä¸‰ç§æ–¹æ³•** æ€»ä½“æ•ˆæœæœ€å¥½ã€‚**ç„¶è€Œ**ï¼Œæ ¹æ®æˆ‘çš„æµ‹è¯•ï¼Œç¬¬ä¸‰ç§æ–¹æ³•åœ¨æ£€æµ‹è¡¨æ ¼æ–¹é¢å­˜åœ¨å›°éš¾ï¼Œæ›´ä¸ç”¨è¯´æ­£ç¡®åˆå¹¶è¡¨æ ¼æ ‡é¢˜äº†ã€‚

**Langchain ä¹Ÿæå‡ºäº†ä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œ[Semi-structured RAG](https://github.com/langchain-ai/langchain/blob/master/cookbook/Semi_Structured_RAG.ipynb?ref=blog.langchain.dev) çš„å…³é”®æŠ€æœ¯åŒ…æ‹¬ï¼š**

* è¡¨æ ¼è§£æä½¿ç”¨ unstructuredï¼Œå³ **ç±»åˆ« (c)**ã€‚
* ç´¢å¼•æ–¹æ³•æ˜¯æ–‡æ¡£æ‘˜è¦ç´¢å¼•ï¼Œå³ **ç±»åˆ« (i)**ï¼Œå°ç‰‡æ®µå†…å®¹ï¼šè¡¨æ ¼æ‘˜è¦ï¼Œå¤§ç‰‡æ®µå†…å®¹ï¼šåŸå§‹è¡¨æ ¼å†…å®¹ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰ã€‚

å¦‚å›¾ 5 æ‰€ç¤ºï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*OqWaWlrRBwT03OI9L5VM-Q.png)

[**Semi-structured and Multi-modal RAG**](https://github.com/langchain-ai/langchain/blob/master/cookbook/Semi_structured_and_multi_modal_RAG.ipynb) **æå‡ºäº†ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼Œ** æ¶æ„å¦‚å›¾ 6 æ‰€ç¤ºã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*cQ-pBUFAS0_6CO1Vc1sl-g.png)

**é€‰é¡¹ 1** ç±»ä¼¼äºæœ¬æ–‡çš„ **ç±»åˆ« (l)**ã€‚å®ƒæ¶‰åŠä½¿ç”¨å¤šæ¨¡æ€åµŒå…¥ï¼ˆå¦‚ [CLIP](https://openai.com/research/clip)ï¼‰æ¥åµŒå…¥å›¾åƒå’Œæ–‡æœ¬ï¼Œé€šè¿‡ç›¸ä¼¼æ€§æœç´¢æ£€ç´¢ä¸¤è€…ï¼Œå¹¶å°†åŸå§‹å›¾åƒå’Œç‰‡æ®µä¼ é€’ç»™å¤šæ¨¡æ€ LLM è¿›è¡Œç­”æ¡ˆåˆæˆã€‚

**é€‰é¡¹ 2** åˆ©ç”¨å¤šæ¨¡æ€ LLMï¼Œå¦‚ [GPT-4V](https://openai.com/research/gpt-4v-system-card)ã€[LLaVA](https://llava.hliu.cc/) æˆ– [FUYU-8b](https://www.adept.ai/blog/fuyu-8b)ï¼Œä»å›¾åƒç”Ÿæˆæ–‡æœ¬æ‘˜è¦ã€‚ç„¶åï¼ŒåµŒå…¥å¹¶æ£€ç´¢æ–‡æœ¬ï¼Œå¹¶å°†æ–‡æœ¬ç‰‡æ®µä¼ é€’ç»™ LLM è¿›è¡Œç­”æ¡ˆåˆæˆã€‚

* è¡¨æ ¼è§£æä½¿ç”¨ unstructuredï¼Œå³ **ç±»åˆ« (d)**ã€‚
* ç´¢å¼•ç»“æ„æ˜¯æ–‡æ¡£æ‘˜è¦ç´¢å¼•ï¼ˆ**ç±»åˆ« (i)**ï¼‰ï¼Œå°ç‰‡æ®µå†…å®¹ï¼šè¡¨æ ¼æ‘˜è¦ï¼Œå¤§ç‰‡æ®µå†…å®¹ï¼šæ–‡æœ¬æ ¼å¼çš„è¡¨æ ¼

**é€‰é¡¹ 3** ä½¿ç”¨å¤šæ¨¡æ€ LLMï¼ˆå¦‚ [GPT-4V](https://openai.com/research/gpt-4v-system-card)ã€[LLaVA](https://llava.hliu.cc/) æˆ– [FUYU-8b](https://www.adept.ai/blog/fuyu-8b)ï¼‰ä»å›¾åƒç”Ÿæˆæ–‡æœ¬æ‘˜è¦ï¼Œç„¶ååµŒå…¥å¹¶æ£€ç´¢å›¾åƒæ‘˜è¦ï¼Œå¹¶å‚è€ƒåŸå§‹å›¾åƒï¼ˆ**ç±»åˆ« (i)**ï¼‰ï¼Œç„¶åå°†åŸå§‹å›¾åƒå’Œæ–‡æœ¬ç‰‡æ®µä¼ é€’ç»™å¤šæ¨¡æ€ LLM è¿›è¡Œç­”æ¡ˆåˆæˆã€‚

# æå‡ºçš„è§£å†³æ–¹æ¡ˆ

æœ¬æ–‡å·²å¯¹å…³é”®æŠ€æœ¯å’Œç°æœ‰è§£å†³æ–¹æ¡ˆè¿›è¡Œäº†æ€»ç»“ã€åˆ†ç±»å’Œè®¨è®ºã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬æå‡ºä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼Œå¦‚å›¾7æ‰€ç¤ºã€‚ä¸ºç®€åŒ–èµ·è§ï¼Œçœç•¥äº†è¯¸å¦‚é‡æ’åºå’ŒæŸ¥è¯¢é‡å†™ç­‰ä¸€äº›RAGæ¨¡å—ã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*7T-ph4ETQ7j6UsPS19BCNA.png)

* è¡¨æ ¼è§£æï¼šä½¿ç”¨Nougatï¼ˆ**ç±»åˆ«(d)**ï¼‰ã€‚æ ¹æ®æˆ‘çš„æµ‹è¯•ï¼Œå…¶è¡¨æ ¼æ£€æµ‹æ•ˆæœä¼˜äºunstructuredï¼ˆ**ç±»åˆ«(c)**ï¼‰ã€‚æ­¤å¤–ï¼ŒNougatèƒ½å¾ˆå¥½åœ°æå–è¡¨æ ¼æ ‡é¢˜ï¼Œéå¸¸ä¾¿äºä¸è¡¨æ ¼å…³è”ã€‚
* æ–‡æ¡£æ‘˜è¦ç´¢å¼•ç»“æ„ï¼ˆ**ç±»åˆ«(i)**ï¼‰ï¼šå°æ•°æ®å—å†…å®¹åŒ…æ‹¬è¡¨æ ¼æ‘˜è¦ï¼Œå¤§æ•°æ®å—å†…å®¹åŒ…æ‹¬ç›¸åº”çš„LaTeXæ ¼å¼è¡¨æ ¼åŠæ–‡æœ¬æ ¼å¼è¡¨æ ¼æ ‡é¢˜ã€‚æˆ‘ä»¬é€šè¿‡[multi-vector retriever](https://python.langchain.com/docs/modules/data_connection/retrievers/multi_vector)å®ç°è¿™ä¸€åŠŸèƒ½ã€‚
* è¡¨æ ¼æ‘˜è¦è·å–æ–¹æ³•ï¼šå°†è¡¨æ ¼åŠè¡¨æ ¼æ ‡é¢˜å‘é€è‡³LLMè¿›è¡Œæ‘˜è¦ç”Ÿæˆã€‚

æ­¤æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºï¼Œå®ƒé«˜æ•ˆè§£æè¡¨æ ¼çš„åŒæ—¶ï¼Œå…¨é¢è€ƒè™‘äº†è¡¨æ ¼æ‘˜è¦ä¸è¡¨æ ¼ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶é¿å…äº†å¤šæ¨¡æ€LLMçš„ä½¿ç”¨ï¼Œä»è€ŒèŠ‚çœäº†æˆæœ¬ã€‚

## Nougat åŸç†

[Nougat](https://arxiv.org/pdf/2308.13418.pdf) åŸºäº [Donut](https://arxiv.org/pdf/2111.15664.pdf) æ¶æ„å¼€å‘ã€‚å®ƒé€šè¿‡ç½‘ç»œéšå¼è¯†åˆ«æ–‡æœ¬ï¼Œæ— éœ€ä»»ä½• OCR ç›¸å…³è¾“å…¥æˆ–æ¨¡å—ï¼Œå¦‚å›¾ 8 æ‰€ç¤ºã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*DUJQmvHuk3BLfGR-5KcA1g.png)

[Nougat è§£æå…¬å¼çš„èƒ½åŠ›ä»¤äººå°è±¡æ·±åˆ»](https://readmedium.com/unveiling-pdf-parsing-how-to-extract-formulas-from-scientific-pdf-papers-a8f126f3511d)ã€‚å®ƒåœ¨è§£æè¡¨æ ¼æ–¹é¢ä¹ŸåŒæ ·å‡ºè‰²ã€‚æ–¹ä¾¿çš„æ˜¯ï¼Œå®ƒèƒ½å¤Ÿå…³è”è¡¨æ ¼æ ‡é¢˜ï¼Œå¦‚å›¾ 9 æ‰€ç¤ºï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*GCZ6Waj9zB9AR3tEKMinKQ.png)

åœ¨æˆ‘æµ‹è¯•çš„åå‡ ç¯‡è®ºæ–‡ä¸­ï¼Œæˆ‘å‘ç°è¡¨æ ¼æ ‡é¢˜æ€»æ˜¯å›ºå®šåœ¨è¡¨æ ¼çš„ä¸‹ä¸€è¡Œã€‚è¿™ç§ä¸€è‡´æ€§è¡¨æ˜è¿™ä¸æ˜¯å¶ç„¶çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯äº†è§£ Nougat æ˜¯å¦‚ä½•å®ç°è¿™ä¸€æ•ˆæœçš„ã€‚

é‰´äºå®ƒæ˜¯ä¸€ä¸ªç¼ºä¹ä¸­é—´ç»“æœçš„ç«¯åˆ°ç«¯æ¨¡å‹ï¼Œå®ƒå¾ˆå¯èƒ½ä¸¥é‡ä¾èµ–å…¶è®­ç»ƒæ•°æ®ã€‚

æ ¹æ®[è®­ç»ƒæ•°æ®æ ¼å¼åŒ–ä»£ç ](https://github.com/facebookresearch/nougat/blob/main/nougat/dataset/parser/markdown.py)ï¼Œå¯¹äºè¡¨æ ¼ï¼Œç´§éš `**\end{table}**` çš„è¡Œæ˜¯ `**caption_parts**`ï¼Œè¿™ä¼¼ä¹ä¸æä¾›çš„è®­ç»ƒæ•°æ®æ ¼å¼ä¸€è‡´ï¼š

```python
def format_element(
    element: Element, keep_refs: bool = False, latex_env: bool = False
) -> List[str]:
    """
    å°†ç»™å®šå…ƒç´ æ ¼å¼åŒ–ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ—è¡¨ã€‚

    å‚æ•°:
        element (Element): è¦æ ¼å¼åŒ–çš„å…ƒç´ ã€‚
        keep_refs (bool, å¯é€‰): æ˜¯å¦åœ¨æ ¼å¼åŒ–ä¸­ä¿ç•™å¼•ç”¨ã€‚é»˜è®¤ä¸º Falseã€‚
        latex_env (bool, å¯é€‰): æ˜¯å¦ä½¿ç”¨ LaTeX ç¯å¢ƒæ ¼å¼åŒ–ã€‚é»˜è®¤ä¸º Falseã€‚

    è¿”å›:
        List[str]: è¡¨ç¤ºæ ¼å¼åŒ–å…ƒç´ çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ—è¡¨ã€‚
    """
    ...
    ...
    if isinstance(element, Table):
        parts = [
            "[TABLE%s]\n\\begin{table}\n"
            % (str(uuid4())[:5] if element.id is None else ":" + str(element.id))
        ]
        parts.extend(format_children(element, keep_refs, latex_env))
        caption_parts = format_element(element.caption, keep_refs, latex_env)
        remove_trailing_whitespace(caption_parts)
        parts.append("\\end{table}\n")
        if len(caption_parts) > 0:
            parts.extend(caption_parts + ["\n"])
        parts.append("[ENDTABLE]\n\n")
        return parts
    ...
    ...
```

## è¯ºæ ¼ç‰¹çš„ä¼˜ç¼ºç‚¹

ä¼˜ç‚¹ï¼š

* è¯ºæ ¼ç‰¹èƒ½å¤Ÿå‡†ç¡®è§£æä»¥å¾€è§£æå·¥å…·éš¾ä»¥å¤„ç†çš„éƒ¨åˆ†ï¼Œå¦‚å…¬å¼å’Œè¡¨æ ¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºLaTeXæºä»£ç ã€‚
* è¯ºæ ¼ç‰¹çš„è§£æç»“æœæ˜¯ä¸€ç§ç±»ä¼¼Markdownçš„åŠç»“æ„åŒ–æ–‡æ¡£ã€‚
* æ–¹ä¾¿è·å–è¡¨æ ¼æ ‡é¢˜å¹¶ä¾¿æ·åœ°ä¸è¡¨æ ¼å…³è”ã€‚

ç¼ºç‚¹ï¼š

* è¯ºæ ¼ç‰¹çš„è§£æé€Ÿåº¦è¾ƒæ…¢ï¼Œå¯¹äºå¤§è§„æ¨¡éƒ¨ç½²å¯èƒ½æ„æˆæŒ‘æˆ˜ã€‚
* ç”±äºè¯ºæ ¼ç‰¹æ˜¯åœ¨ç§‘å­¦è®ºæ–‡ä¸Šè®­ç»ƒçš„ï¼Œå› æ­¤åœ¨ä¸ç±»ä¼¼ç»“æ„çš„æ–‡æ¡£ä¸Šè¡¨ç°å‡ºè‰²ã€‚å¯¹äºéæ‹‰ä¸æ–‡æ–‡æœ¬æ–‡æ¡£ï¼Œå…¶æ€§èƒ½æœ‰æ‰€ä¸‹é™ã€‚
* è¯ºæ ¼ç‰¹æ¨¡å‹æ¯æ¬¡ä»…è®­ç»ƒç§‘å­¦è®ºæ–‡çš„ä¸€é¡µï¼Œç¼ºä¹å¯¹å…¶ä»–é¡µé¢çš„äº†è§£ã€‚è¿™å¯èƒ½å¯¼è‡´è§£æå†…å®¹å­˜åœ¨ä¸€äº›ä¸ä¸€è‡´æ€§ã€‚å› æ­¤ï¼Œå¦‚æœè¯†åˆ«æ•ˆæœä¸ä½³ï¼Œå»ºè®®å°†PDFæ‹†åˆ†ä¸ºå•ç‹¬çš„é¡µé¢å¹¶é€é¡µè§£æã€‚
* åœ¨åŒæ è®ºæ–‡ä¸­è§£æè¡¨æ ¼çš„æ•ˆæœä¸å¦‚å•æ è®ºæ–‡ã€‚

## ä»£ç å®ç°

é¦–å…ˆï¼Œå®‰è£…ç›¸å…³çš„ Python åŒ…

```python
pip install langchain
pip install chromadb
pip install nougat-ocr
```
å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ Python åŒ…çš„ç‰ˆæœ¬ï¼š

```python
langchain                                0.1.12
langchain-community                      0.0.28
langchain-core                           0.1.31
langchain-openai                         0.0.8
langchain-text-splitters                 0.0.1

chroma-hnswlib                           0.7.3
chromadb                                 0.4.24

nougat-ocr                               0.1.17
```
è®¾ç½®ç¯å¢ƒå¹¶å¯¼å…¥ï¼š

```python
import os
os.environ["OPENAI_API_KEY"] = "YOUR_OPEN_AI_KEY"

import subprocess
import uuid

from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain.retrievers.multi_vector import MultiVectorRetriever
from langchain.storage import InMemoryStore
from langchain_community.vectorstores import Chroma
from langchain_core.documents import Document
from langchain_openai import OpenAIEmbeddings
from langchain_core.runnables import RunnablePassthrough
```
ä¸‹è½½è®ºæ–‡ [Attention Is All You Need](https://arxiv.org/pdf/1706.03762.pdf) åˆ° `**YOUR_PDF_PATH**`ï¼Œè¿è¡Œ nougat è§£æ PDF æ–‡ä»¶ï¼Œå¹¶ä»è§£æç»“æœä¸­è·å– LaTeX æ ¼å¼çš„è¡¨æ ¼å’Œæ–‡æœ¬æ ¼å¼çš„è¡¨æ ¼æ ‡é¢˜ã€‚é¦–æ¬¡æ‰§è¡Œå°†ä¸‹è½½å¿…è¦çš„æ¨¡å‹æ–‡ä»¶ã€‚

```python
def june_run_nougat(file_path, output_dir):
    # è¿è¡Œ Nougat å¹¶å°†ç»“æœå­˜å‚¨ä¸º Mathpix Markdown
    cmd = ["nougat", file_path, "-o", output_dir, "-m", "0.1.0-base", "--no-skipping"]
    res = subprocess.run(cmd) 
    if res.returncode != 0:
        print("è¿è¡Œ nougat æ—¶å‡ºé”™ã€‚")
        return res.returncode
    else:
        print("æ“ä½œå®Œæˆï¼")
        return 0

def june_get_tables_from_mmd(mmd_path):
    f = open(mmd_path)
    lines = f.readlines()
    res = []
    tmp = []
    flag = ""
    for line in lines:
        if line == "\\begin{table}\n":
            flag = "BEGINTABLE"
        elif line == "\\end{table}\n":
            flag = "ENDTABLE"
        
        if flag == "BEGINTABLE":
            tmp.append(line)
        elif flag == "ENDTABLE":
            tmp.append(line)
            flag = "CAPTION"
        elif flag == "CAPTION":
            tmp.append(line)
            flag = "MARKDOWN"
            print('-' * 100)
            print(''.join(tmp))
            res.append(''.join(tmp))
            tmp = []

    return res

file_path = "YOUR_PDF_PATH"
output_dir = "YOUR_OUTPUT_DIR_PATH"

if june_run_nougat(file_path, output_dir) == 1:
    import sys
    sys.exit(1)

mmd_path = output_dir + '/' + os.path.splitext(file_path)[0].split('/')[-1] + ".mmd" 
tables = june_get_tables_from_mmd(mmd_path)
```
å‡½æ•° `**june_get_tables_from_mmd**` ç”¨äºä» `**mmd**` æ–‡ä»¶ä¸­æå–ä» `**\begin{table}**` åˆ° `**\end{table}**` çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ `**\end{table}**` ä¹‹åçš„è¡Œï¼Œå¦‚å›¾ 10 æ‰€ç¤ºã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*lwLX5_CDfOYzgJdy8Xnbvw.png)

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°šæœªæ‰¾åˆ°å®˜æ–¹æ–‡æ¡£æŒ‡å®šè¡¨æ ¼æ ‡é¢˜å¿…é¡»ä½äºè¡¨æ ¼ä¸‹æ–¹æˆ–è¡¨æ ¼åº”ä»¥ `**\begin{table}**` å¼€å§‹å¹¶ä»¥ `**\end{table}**` ç»“æŸã€‚å› æ­¤ï¼Œ`**june_get_tables_from_mmd**` æ˜¯å¯å‘å¼çš„ã€‚

ä»¥ä¸‹æ˜¯è§£æ PDF ä¸­è¡¨æ ¼çš„ç»“æœï¼š

```python
æ“ä½œå®Œæˆï¼
----------------------------------------------------------------------------------------------------
\begin{table}
\begin{tabular}{l c c c} \hline \hline Layer Type & Complexity per Layer & Sequential Operations & Maximum Path Length \\ \hline Self-Attention & \(O(n^{2}\cdot d)\) & \(O(1)\) & \(O(1)\) \\ Recurrent & \(O(n\cdot d^{2})\) & \(O(n)\) & \(O(n)\) \\ Convolutional & \(O(k\cdot n\cdot d^{2})\) & \(O(1)\) & \(O(log_{k}(n))\) \\ Self-Attention (restricted) & \(O(r\cdot n\cdot d)\) & \(O(1)\) & \(O(n/r)\) \\ \hline \hline \end{tabular}
\end{table}
è¡¨ 1ï¼šä¸åŒå±‚ç±»å‹çš„æœ€å¤§è·¯å¾„é•¿åº¦ã€æ¯å±‚å¤æ‚åº¦å’Œæœ€å°é¡ºåºæ“ä½œæ•°ã€‚\(n\) æ˜¯åºåˆ—é•¿åº¦ï¼Œ\(d\) æ˜¯è¡¨ç¤ºç»´åº¦ï¼Œ\(k\) æ˜¯å·ç§¯æ ¸å¤§å°ï¼Œ\(r\) æ˜¯å—é™è‡ªæ³¨æ„åŠ›ä¸­çš„é‚»åŸŸå¤§å°ã€‚

----------------------------------------------------------------------------------------------------
\begin{table}
\begin{tabular}{l c c c c} \hline \hline \multirow{2}{*}{Model} & \multicolumn{2}{c}{BLEU} & \multicolumn{2}{c}{Training Cost (FLOPs)} \\ \cline{2-5}  & EN-DE & EN-FR & EN-DE & EN-FR \\ \hline ByteNet [18] & 23.75 & & & \\ Deep-Att + PosUnk [39] & & 39.2 & & \(1.0\cdot 10^{20}\) \\ GNMT + RL [38] & 24.6 & 39.92 & \(2.3\cdot 10^{19}\) & \(1.4\cdot 10^{20}\) \\ ConvS2S [9] & 25.16 & 40.46 & \(9.6\cdot 10^{18}\) & \(1.5\cdot 10^{20}\) \\ MoE [32] & 26.03 & 40.56 & \(2.0\cdot 10^{19}\) & \(1.2\cdot 10^{20}\) \\ \hline Deep-Att + PosUnk Ensemble [39] & & 40.4 & & \(8.0\cdot 10^{20}\) \\ GNMT + RL Ensemble [38] & 26.30 & 41.16 & \(1.8\cdot 10^{20}\) & \(1.1\cdot 10^{21}\) \\ ConvS2S Ensemble [9] & 26.36 & **41.29** & \(7.7\cdot 10^{19}\) & \(1.2\cdot 10^{21}\) \\ \hline Transformer (base model) & 27.3 & 38.1 & & \(\mathbf{3.3\cdot 10^{18}}\) \\ Transformer (big) & **28.4** & **41.8** & & \(2.3\cdot 10^{19}\) \\ \hline \hline \end{tabular}
\end{table}
è¡¨ 2ï¼šTransformer åœ¨è‹±è¯­åˆ°å¾·è¯­å’Œè‹±è¯­åˆ°æ³•è¯­çš„ newstest2014 æµ‹è¯•ä¸­ï¼Œä»¥è¾ƒä½çš„è®­ç»ƒæˆæœ¬å®ç°äº†æ¯”ä»¥å¾€æœ€å…ˆè¿›çš„æ¨¡å‹æ›´å¥½çš„ BLEU åˆ†æ•°ã€‚

----------------------------------------------------------------------------------------------------
\begin{table}
\begin{tabular}{c|c c c c c c c c|c c c c} \hline \hline  & \(N\) & \(d_{\text{model}}\) & \(d_{\text{ff}}\) & \(h\) & \(d_{k}\) & \(d_{v}\) & \(P_{drop}\) & \(\epsilon_{ls}\) & train steps & PPL & BLEU & params \\ \hline base & 6 & 512 & 2048 & 8 & 64 & 64 & 0.1 & 0.1 & 100K & 4.92 & 25.8 & 65 \\ \hline \multirow{4}{*}{(A)} & \multicolumn{1}{c}{} & & 1 & 512 & 512 & & & & 5.29 & 24.9 & \\  & & & & 4 & 128 & 128 & & & & 5.00 & 25.5 & \\  & & & & 16 & 32 & 32 & & & & 4.91 & 25.8 & \\  & & & & 32 & 16 & 16 & & & & 5.01 & 25.4 & \\ \hline (B) & \multicolumn{1}{c}{} & & \multicolumn{1}{c}{} & & 16 & & & & & 5.16 & 25.1 & 58 \\  & & & & & 32 & & & & & 5.01 & 25.4 & 60 \\ \hline \multirow{4}{*}{(C)} & 2 & \multicolumn{1}{c}{} & & & & & & & & 6.11 & 23.7 & 36 \\  & 4 & & & & & & & & 5.19 & 25.3 & 50 \\  & 8 & & & & & & & & 4.88 & 25.5 & 80 \\  & & 256 & & 32 & 32 & & & & 5.75 & 24.5 & 28 \\  & 1024 & & 128 & 128 & & & & 4.66 & 26.0 & 168 \\  & & 1024 & & & & & & 5.12 & 25.4 & 53 \\  & & 4096 & & & & & & 4.75 & 26.2 & 90 \\ \hline \multirow{4}{*}{(D)} & \multicolumn{1}{c}{} & & & & & 0.0 & & 5.77 & 24.6 & \\  & & & & & & 0.2 & & 4.95 & 25.5 & \\  & & & & & & & 0.0 & 4.67 & 25.3 & \\  & & & & & & & 0.2 & 5.47 & 25.7 & \\ \hline (E) & \multicolumn{1}{c}{} & \multicolumn{1}{c}{} & & \multicolumn{1}{c}{} & & & & & 4.92 & 25.7 & \\ \hline big & 6 & 1024 & 4096 & 16 & & 0.3 & 300K & **4.33** & **26.4** & 213 \\ \hline \hline \end{tabular}
\end{table}
è¡¨ 3ï¼šTransformer æ¶æ„çš„å˜ä½“ã€‚æœªåˆ—å‡ºçš„å€¼ä¸åŸºç¡€æ¨¡å‹ç›¸åŒã€‚æ‰€æœ‰æŒ‡æ ‡å‡åŸºäºè‹±è¯­åˆ°å¾·è¯­ç¿»è¯‘å¼€å‘é›† newstest2013ã€‚åˆ—å‡ºçš„å›°æƒ‘åº¦æ˜¯æ ¹æ®æˆ‘ä»¬çš„å­—èŠ‚å¯¹ç¼–ç çš„æ¯ä¸ªè¯ç‰‡æ®µï¼Œä¸åº”ä¸æ¯ä¸ªè¯çš„å›°æƒ‘åº¦è¿›è¡Œæ¯”è¾ƒã€‚

----------------------------------------------------------------------------------------------------
\begin{table}
\begin{tabular}{c|c|c} \hline
**Parser** & **Training** & **WSJ 23 F1** \\ \hline Vinyals \& Kaiser et al. (2014) [37] & WSJ only, discriminative & 88.3 \\ Petrov et al. (2006) [29] & WSJ only, discriminative & 90.4 \\ Zhu et al. (2013) [40] & WSJ only, discriminative & 90.4 \\ Dyer et al. (2016) [8] & WSJ only, discriminative & 91.7 \\ \hline Transformer (4 layers) & WSJ only, discriminative & 91.3 \\ \hline Zhu et al. (2013) [40] & semi-supervised & 91.3 \\ Huang \& Harper (2009) [14] & semi-supervised & 91.3 \\ McClosky et al. (2006) [26] & semi-supervised & 92.1 \\ Vinyals \& Kaiser el al. (2014) [37] & semi-supervised & 92.1 \\ \hline Transformer (4 layers) & semi-supervised & 92.7 \\ \hline Luong et al. (2015) [23] & multi-task & 93.0 \\ Dyer et al. (2016) [8] & generative & 93.3 \\ \hline \end{tabular}
\end{table}
è¡¨ 4ï¼šTransformer åœ¨è‹±è¯­æˆåˆ†è§£æï¼ˆç»“æœåŸºäº WSJ ç¬¬ 23 èŠ‚ï¼‰ä¸Šå…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›* [5] Kyunghyun Cho, Bart van Merrienboer, Caglar Gulcehre, Fethi Bougares, Holger Schwenk, and Yoshua Bengio. Learning phrase representations using rnn encoder-decoder for statistical machine translation. _CoRR_, abs/1406.1078, 2014.
```
ç„¶åä½¿ç”¨ LLM æ€»ç»“è¡¨æ ¼ï¼š

```python
# æç¤º
prompt_text = """ä½ æ˜¯ä¸€ä¸ªè´Ÿè´£æ€»ç»“è¡¨æ ¼å’Œæ–‡æœ¬çš„åŠ©æ‰‹ã€‚\ 
ç»™å‡ºè¡¨æ ¼æˆ–æ–‡æœ¬çš„ç®€æ˜æ€»ç»“ã€‚è¡¨æ ¼æ ¼å¼ä¸º LaTeXï¼Œå…¶æ ‡é¢˜ä¸ºçº¯æ–‡æœ¬æ ¼å¼ï¼š{element}  """
prompt = ChatPromptTemplate.from_template(prompt_text)

# æ€»ç»“é“¾
model = ChatOpenAI(temperature = 0, model = "gpt-3.5-turbo")
summarize_chain = {"element": lambda x: x} | prompt | model | StrOutputParser()
# è·å–è¡¨æ ¼æ€»ç»“
table_summaries = summarize_chain.batch(tables, {"max_concurrency": 5})
print(table_summaries)
```
ä»¥ä¸‹æ˜¯ [Attention Is All You Need](https://arxiv.org/pdf/1706.03762.pdf) ä¸­æ‰¾åˆ°çš„å››ä¸ªè¡¨æ ¼çš„æ€»ç»“ï¼Œå¦‚å›¾ 11 æ‰€ç¤ºï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*gyGp6uUat9x_DKiTv93w6g.png)

ä½¿ç”¨ [Multi-Vector Retriever](https://python.langchain.com/docs/modules/data_connection/retrievers/multi_vector) æ„å»ºæ–‡æ¡£æ€»ç»“ç´¢å¼•ç»“æ„ã€‚

```python
# ç”¨äºç´¢å¼•å­å—çš„å‘é‡å­˜å‚¨
vectorstore = Chroma(collection_name = "summaries", embedding_function = OpenAIEmbeddings())

# çˆ¶æ–‡æ¡£çš„å­˜å‚¨å±‚
store = InMemoryStore()
id_key = "doc_id"

# æ£€ç´¢å™¨ï¼ˆåˆå§‹ä¸ºç©ºï¼‰
retriever = MultiVectorRetriever(
    vectorstore = vectorstore,
    docstore = store,
    id_key = id_key,
    search_kwargs={"k": 1} # è§£å†³è¯·æ±‚çš„ç»“æœæ•° 4 å¤§äºç´¢å¼•ä¸­å…ƒç´ æ•°çš„é—®é¢˜ï¼Œæ›´æ–° n_results = 1
)

# æ·»åŠ è¡¨æ ¼
table_ids = [str(uuid.uuid4()) for _ in tables]
summary_tables = [
    Document(page_content = s, metadata = {id_key: table_ids[i]})
    for i, s in enumerate(table_summaries)
]
retriever.vectorstore.add_documents(summary_tables)
retriever.docstore.mset(list(zip(table_ids, tables)))
```
ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæ„å»ºä¸€ä¸ªç®€å•çš„ RAG ç®¡é“å¹¶æ‰§è¡ŒæŸ¥è¯¢ï¼š

```python
# æç¤ºæ¨¡æ¿
template = """ä»…æ ¹æ®ä»¥ä¸‹ä¸Šä¸‹æ–‡ï¼ˆå¯èƒ½åŒ…å«æ–‡æœ¬å’Œè¡¨æ ¼ï¼‰å›ç­”é—®é¢˜ï¼Œä¸Šä¸‹æ–‡ä¸­åŒ…å«ä¸€ä¸ªLaTeXæ ¼å¼çš„è¡¨æ ¼å’Œä¸€ä¸ªçº¯æ–‡æœ¬æ ¼å¼çš„è¡¨æ ¼æ ‡é¢˜ï¼š
{context}
é—®é¢˜ï¼š{question}
"""
prompt = ChatPromptTemplate.from_template(template)

# LLM
model = ChatOpenAI(temperature = 0, model = "gpt-3.5-turbo")


# ç®€å•çš„RAGæµç¨‹
chain = (
    {"context": retriever, "question": RunnablePassthrough()}
    | prompt
    | model
    | StrOutputParser()
)


print(chain.invoke("å½“å±‚ç±»å‹ä¸ºSelf-Attentionæ—¶ï¼Œæ¯å±‚çš„å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"))  # å…³äºè¡¨1çš„æŸ¥è¯¢

print(chain.invoke("å“ªä¸ªè§£æå™¨åœ¨BLEU EN-DEä¸Šè¡¨ç°æœ€å·®"))  # å…³äºè¡¨2çš„æŸ¥è¯¢

print(chain.invoke("å“ªä¸ªè§£æå™¨åœ¨WSJ 23 F1ä¸Šè¡¨ç°æœ€å¥½"))  # å…³äºè¡¨4çš„æŸ¥è¯¢


```
æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼Œå±•ç¤ºäº†å¤šä¸ªé—®é¢˜è¢«å‡†ç¡®å›ç­”ï¼Œå¦‚å›¾12æ‰€ç¤ºï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*ijSgofZsFVb7wE-4njX7Rg.png)

æ•´ä½“ä»£ç å¦‚ä¸‹ï¼š


```python
import os
os.environ["OPENAI_API_KEY"] = "YOUR_OPEN_AI_KEY"

import subprocess
import uuid

from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI
from langchain.retrievers.multi_vector import MultiVectorRetriever
from langchain.storage import InMemoryStore
from langchain_community.vectorstores import Chroma
from langchain_core.documents import Document
from langchain_openai import OpenAIEmbeddings
from langchain_core.runnables import RunnablePassthrough


def june_run_nougat(file_path, output_dir):
    # è¿è¡ŒNougatå¹¶å°†ç»“æœå­˜å‚¨ä¸ºMathpix Markdown
    cmd = ["nougat", file_path, "-o", output_dir, "-m", "0.1.0-base", "--no-skipping"]
    res = subprocess.run(cmd) 
    if res.returncode != 0:
        print("è¿è¡Œnougatæ—¶å‡ºé”™ã€‚")
        return res.returncode
    else:
        print("æ“ä½œå®Œæˆï¼")
        return 0

def june_get_tables_from_mmd(mmd_path):
    f = open(mmd_path)
    lines = f.readlines()
    res = []
    tmp = []
    flag = ""
    for line in lines:
        if line == "\\begin{table}\n":
            flag = "BEGINTABLE"
        elif line == "\\end{table}\n":
            flag = "ENDTABLE"
        
        if flag == "BEGINTABLE":
            tmp.append(line)
        elif flag == "ENDTABLE":
            tmp.append(line)
            flag = "CAPTION"
        elif flag == "CAPTION":
            tmp.append(line)
            flag = "MARKDOWN"
            print('-' * 100)
            print(''.join(tmp))
            res.append(''.join(tmp))
            tmp = []

    return res

file_path = "YOUR_PDF_PATH"
output_dir = "YOUR_OUTPUT_DIR_PATH"

if june_run_nougat(file_path, output_dir) == 1:
    import sys
    sys.exit(1)

mmd_path = output_dir + '/' + os.path.splitext(file_path)[0].split('/')[-1] + ".mmd" 
tables = june_get_tables_from_mmd(mmd_path)


# æç¤º
prompt_text = """ä½ æ˜¯ä¸€ä¸ªè´Ÿè´£æ€»ç»“è¡¨æ ¼å’Œæ–‡æœ¬çš„åŠ©æ‰‹ã€‚\ 
è¯·å¯¹è¡¨æ ¼æˆ–æ–‡æœ¬è¿›è¡Œç®€è¦æ€»ç»“ã€‚è¡¨æ ¼é‡‡ç”¨LaTeXæ ¼å¼ï¼Œå…¶æ ‡é¢˜ä¸ºçº¯æ–‡æœ¬æ ¼å¼ï¼š{element}  """
prompt = ChatPromptTemplate.from_template(prompt_text)

# æ€»ç»“æµç¨‹
model = ChatOpenAI(temperature = 0, model = "gpt-3.5-turbo")
summarize_chain = {"element": lambda x: x} | prompt | model | StrOutputParser()
# è·å–è¡¨æ ¼æ€»ç»“
table_summaries = summarize_chain.batch(tables, {"max_concurrency": 5})
print(table_summaries)

# ç”¨äºç´¢å¼•å­å—çš„å‘é‡å­˜å‚¨
vectorstore = Chroma(collection_name = "summaries", embedding_function = OpenAIEmbeddings())

# çˆ¶æ–‡æ¡£çš„å­˜å‚¨å±‚
store = InMemoryStore()
id_key = "doc_id"

# æ£€ç´¢å™¨ï¼ˆåˆå§‹ä¸ºç©ºï¼‰
retriever = MultiVectorRetriever(
    vectorstore = vectorstore,
    docstore = store,
    id_key = id_key,
    search_kwargs={"k": 1} # è§£å†³è¯·æ±‚çš„ç»“æœæ•°é‡4å¤§äºç´¢å¼•ä¸­çš„å…ƒç´ æ•°é‡..., æ›´æ–°n_results = 1
)

# æ·»åŠ è¡¨æ ¼
table_ids = [str(uuid.uuid4()) for _ in tables]
summary_tables = [
    Document(page_content = s, metadata = {id_key: table_ids[i]})
    for i, s in enumerate(table_summaries)
]
retriever.vectorstore.add_documents(summary_tables)
retriever.docstore.mset(list(zip(table_ids, tables)))


# æç¤ºæ¨¡æ¿
template = """ä»…æ ¹æ®ä»¥ä¸‹ä¸Šä¸‹æ–‡ï¼ˆå¯èƒ½åŒ…å«æ–‡æœ¬å’Œè¡¨æ ¼ï¼‰å›ç­”é—®é¢˜ï¼Œä¸Šä¸‹æ–‡ä¸­åŒ…å«ä¸€ä¸ªLaTeXæ ¼å¼çš„è¡¨æ ¼å’Œä¸€ä¸ªçº¯æ–‡æœ¬æ ¼å¼çš„è¡¨æ ¼æ ‡é¢˜ï¼š
{context}
é—®é¢˜ï¼š{question}
"""
prompt = ChatPromptTemplate.from_template(template)

# LLM
model = ChatOpenAI(temperature = 0, model = "gpt-3.5-turbo")

# ç®€å•çš„RAGæµç¨‹
chain = (
    {"context": retriever, "question": RunnablePassthrough()}
    | prompt
    | model
    | StrOutputParser()
)

print(chain.invoke("å½“å±‚ç±»å‹ä¸ºSelf-Attentionæ—¶ï¼Œæ¯å±‚çš„å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ"))  # å…³äºè¡¨1çš„æŸ¥è¯¢

print(chain.invoke("å“ªä¸ªè§£æå™¨åœ¨BLEU EN-DEä¸Šè¡¨ç°æœ€å·®"))  # å…³äºè¡¨2çš„æŸ¥è¯¢

print(chain.invoke("å“ªä¸ªè§£æå™¨åœ¨WSJ 23 F1ä¸Šè¡¨ç°æœ€å¥½"))  # å…³äºè¡¨4çš„æŸ¥è¯¢
```

# ç»“è®º

æœ¬æ–‡è®¨è®ºäº†RAGæµç¨‹ä¸­è¡¨æ ¼å¤„ç†çš„å…³é”®æŠ€æœ¯å’Œç°æœ‰è§£å†³æ–¹æ¡ˆï¼Œå¹¶æå‡ºäº†ä¸€ç§è§£å†³æ–¹æ¡ˆåŠå…¶å…·ä½“å®ç°ã€‚

æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä½¿ç”¨nougatæ¥è§£æè¡¨æ ¼ã€‚ç„¶è€Œï¼Œå¦‚æœæœ‰æ›´å¿«æ›´æœ‰æ•ˆçš„è§£æå·¥å…·å‡ºç°ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè€ƒè™‘æ›¿æ¢nougatã€‚**æˆ‘ä»¬å¯¹å·¥å…·çš„æ€åº¦æ˜¯å…ˆæœ‰æ­£ç¡®çš„æƒ³æ³•ï¼Œå†å¯»æ‰¾å·¥å…·æ¥å®ç°å®ƒï¼Œè€Œä¸æ˜¯ä¾èµ–äºæŸä¸ªç‰¹å®šå·¥å…·ã€‚**

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¡¨æ ¼å†…å®¹è¾“å…¥åˆ°LLMä¸­ã€‚ä½†åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åº”è€ƒè™‘åˆ°è¡¨æ ¼è¶…å‡ºLLMä¸Šä¸‹æ–‡é•¿åº¦çš„æƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡‡ç”¨æœ‰æ•ˆçš„åˆ†å—æ–¹æ³•æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚

æœ€åï¼Œå¦‚æœæœ¬æ–‡å­˜åœ¨ä»»ä½•é”™è¯¯æˆ–é—æ¼ï¼Œæˆ–è€…æ‚¨æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚

# ç”¨ç®€å•è‹±è¯­ ğŸš€

*æ„Ÿè°¢æ‚¨æˆä¸º[**ç”¨ç®€å•è‹±è¯­**](https://plainenglish.io/)ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨æ‚¨ç¦»å¼€ä¹‹å‰ï¼š*

* è¯·åŠ¡å¿…**ç‚¹èµ**å¹¶**å…³æ³¨**ä½œè€…ï¸ğŸ‘**ï¸ï¸**
* å…³æ³¨æˆ‘ä»¬ï¼š[**X**](https://twitter.com/inPlainEngHQ) **| [LinkedIn](https://www.linkedin.com/company/inplainenglish/) | [YouTube](https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw) | [Discord](https://discord.gg/in-plain-english-709094664682340443) | [Newsletter](https://newsletter.plainenglish.io/)**
* è®¿é—®æˆ‘ä»¬çš„å…¶ä»–å¹³å°ï¼š[**Stackademic**](https://stackademic.com/) **| [CoFeed](https://cofeed.app/) | [Venture](https://venturemagazine.net/) | [Cubed](https://blog.cubed.run/)**
* æ›´å¤šå†…å®¹è¯·è®¿é—®[**PlainEnglish.io**](https://plainenglish.io/)
