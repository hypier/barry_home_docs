
---
cover: https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*6GIC4KplDWtnL2lEwGR_UA.png
date: '2024-02-05 22:16:01'
tags:
  - RAGè¯„ä¼°
  - LlamaIndex
  - ç”Ÿæˆæ¨¡å‹
title: é«˜çº§RAG 03ä½¿ç”¨RAGAs  LlamaIndexè¿›è¡ŒRAGè¯„ä¼°

---


## åŒ…å«åŸç†ã€å›¾è¡¨å’Œä»£ç 

å¦‚æœæ‚¨ä¸ºå®é™…ä¸šåŠ¡ç³»ç»Ÿå¼€å‘äº†æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åº”ç”¨ç¨‹åºï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šå…³æ³¨å…¶æ•ˆæœã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨å¸Œæœ›è¯„ä¼°RAGçš„è¡¨ç°å¦‚ä½•ã€‚

æ­¤å¤–ï¼Œå¦‚æœæ‚¨å‘ç°ç°æœ‰çš„RAGæ•ˆæœä¸å¤Ÿç†æƒ³ï¼Œ**æ‚¨å¯èƒ½éœ€è¦éªŒè¯é«˜çº§RAGæ”¹è¿›æ–¹æ³•çš„æœ‰æ•ˆæ€§**ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨éœ€è¦è¿›è¡Œè¯„ä¼°ï¼Œçœ‹çœ‹è¿™äº›æ”¹è¿›æ–¹æ³•æ˜¯å¦æœ‰æ•ˆã€‚

**åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»ç”±[RAGAsï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆè¯„ä¼°ï¼‰](https://arxiv.org/pdf/2309.15217.pdf)æå‡ºçš„RAGè¯„ä¼°æŒ‡æ ‡**ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°RAGç®¡é“çš„æ¡†æ¶ã€‚**ç„¶åï¼Œæˆ‘ä»¬è§£é‡Šå¦‚ä½•ä½¿ç”¨RAGAs + LlamaIndexå®ç°æ•´ä¸ªè¯„ä¼°è¿‡ç¨‹ã€‚**

# RAGè¯„ä¼°æŒ‡æ ‡

**ç®€è€Œè¨€ä¹‹ï¼ŒRAGè¿‡ç¨‹æ¶‰åŠä¸‰ä¸ªä¸»è¦éƒ¨åˆ†**ï¼šè¾“å…¥æŸ¥è¯¢ã€æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä»¥åŠLLMç”Ÿæˆçš„å“åº”ã€‚è¿™ä¸‰ä¸ªå…ƒç´ æ„æˆäº†RAGè¿‡ç¨‹ä¸­æœ€é‡è¦çš„ä¸‰å…ƒç»„ï¼Œå¹¶ä¸”ç›¸äº’ä¾èµ–ã€‚

å› æ­¤ï¼Œå¯ä»¥é€šè¿‡è¡¡é‡è¿™äº›ä¸‰å…ƒç»„ä¹‹é—´çš„ç›¸å…³æ€§æ¥è¯„ä¼°RAGçš„æœ‰æ•ˆæ€§ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚



[è®ºæ–‡](https://arxiv.org/pdf/2309.15217.pdf)ä¸­æåˆ°äº†æ€»å…±3ä¸ªæŒ‡æ ‡ï¼šå¿ å®åº¦ï¼ˆFaithfulnessï¼‰ã€ç­”æ¡ˆç›¸å…³æ€§ï¼ˆAnswer Relevanceï¼‰å’Œä¸Šä¸‹æ–‡ç›¸å…³æ€§ï¼ˆContext Relevanceï¼‰ï¼Œè¿™äº›æŒ‡æ ‡ä¸éœ€è¦è®¿é—®äººå·¥æ ‡æ³¨çš„æ•°æ®é›†æˆ–å‚è€ƒç­”æ¡ˆã€‚

æ­¤å¤–ï¼Œ[RAGAsç½‘ç«™](https://docs.ragas.io/en/latest/concepts/metrics/index.html)è¿˜ä»‹ç»äº†å¦å¤–ä¸¤ä¸ªæŒ‡æ ‡ï¼šä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ï¼ˆContext Precisionï¼‰å’Œä¸Šä¸‹æ–‡å¬å›ç‡ï¼ˆContext Recallï¼‰ã€‚

## å¿ å®åº¦/åŸºäºäº‹å®æ€§

å¿ å®åº¦æŒ‡çš„æ˜¯ç¡®ä¿ç­”æ¡ˆåŸºäºç»™å®šçš„ä¸Šä¸‹æ–‡ã€‚è¿™å¯¹äºé¿å…å¹»è§‰å’Œç¡®ä¿æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡èƒ½ä½œä¸ºç”Ÿæˆç­”æ¡ˆçš„ä¾æ®è‡³å…³é‡è¦ã€‚

å¦‚æœå¾—åˆ†è¾ƒä½ï¼Œè¡¨æ˜LLMçš„å›åº”ä¸ç¬¦åˆæ£€ç´¢åˆ°çš„çŸ¥è¯†ï¼Œæä¾›è™šå¹»ç­”æ¡ˆçš„å¯èƒ½æ€§å¢åŠ ã€‚ä¾‹å¦‚ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*WaC1zztISLJ-WN7VCwIsGw.png)

ä¸ºäº†è¯„ä¼°å¿ å®åº¦ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨LLMæå–ä¸€ç»„é™ˆè¿°ï¼Œ`**S(a(q))**`ã€‚æ–¹æ³•æ˜¯ä½¿ç”¨ä»¥ä¸‹æç¤ºï¼š

```python
ç»™å®šä¸€ä¸ªé—®é¢˜å’Œç­”æ¡ˆï¼Œä»ç­”æ¡ˆçš„æ¯ä¸ªå¥å­ä¸­åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªé™ˆè¿°ã€‚
question: [question]
answer: [answer]
```
ç”Ÿæˆ`**S(a(q))**`åï¼ŒLLMåˆ¤æ–­æ¯ä¸ªé™ˆè¿°siæ˜¯å¦èƒ½ä»`**c(q)**`æ¨æ–­å‡ºæ¥ã€‚è¿™ä¸€éªŒè¯æ­¥éª¤é€šè¿‡ä»¥ä¸‹æç¤ºè¿›è¡Œï¼š

```python
è€ƒè™‘ç»™å®šçš„ä¸Šä¸‹æ–‡å’Œä»¥ä¸‹é™ˆè¿°ï¼Œç„¶ååˆ¤æ–­å®ƒä»¬æ˜¯å¦å¾—åˆ°ä¸Šä¸‹æ–‡ä¸­ä¿¡æ¯çš„æ”¯æ’‘ã€‚åœ¨å¾—å‡ºç»“è®ºï¼ˆæ˜¯/å¦ï¼‰å‰ï¼Œä¸ºæ¯ä¸ªé™ˆè¿°æä¾›ç®€çŸ­è§£é‡Šã€‚æŒ‰ç…§æŒ‡å®šæ ¼å¼ï¼Œåœ¨æœ€åä¾æ¬¡ä¸ºæ¯ä¸ªé™ˆè¿°æä¾›æœ€ç»ˆç»“è®ºã€‚è¯·å‹¿åç¦»æŒ‡å®šæ ¼å¼ã€‚

statement: [statement 1]
...
statement: [statement n]
```
æœ€ç»ˆçš„å¿ å®åº¦å¾—åˆ†`**F**`è®¡ç®—ä¸º`**F = |V| / |S|**`ï¼Œå…¶ä¸­`**|V|**`è¡¨ç¤ºLLMæ”¯æŒçš„é™ˆè¿°æ•°é‡ï¼Œ`**|S|**`è¡¨ç¤ºé™ˆè¿°æ€»æ•°ã€‚

## ç­”æ¡ˆç›¸å…³æ€§

æ­¤æŒ‡æ ‡è¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸æŸ¥è¯¢ä¹‹é—´çš„ç›¸å…³æ€§ã€‚å¾—åˆ†è¶Šé«˜ï¼Œè¡¨ç¤ºç›¸å…³æ€§è¶Šå¥½ã€‚ä¾‹å¦‚ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*Xi0gJgpHR0Q_bYIRkhGd6A.png)

ä¸ºäº†ä¼°è®¡ç­”æ¡ˆçš„ç›¸å…³æ€§ï¼Œæˆ‘ä»¬æç¤ºLLMæ ¹æ®ç»™å®šçš„ç­”æ¡ˆ`**a(q)**`ç”Ÿæˆnä¸ªæ½œåœ¨é—®é¢˜`**qi**`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
Generate a question for the given answer.

answer: [answer]
```
ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨æ–‡æœ¬åµŒå…¥æ¨¡å‹è·å–æ‰€æœ‰é—®é¢˜çš„åµŒå…¥è¡¨ç¤ºã€‚

å¯¹äºæ¯ä¸ª`**qi**`ï¼Œæˆ‘ä»¬è®¡ç®—å…¶ä¸åŸå§‹é—®é¢˜`**q**`çš„ç›¸ä¼¼åº¦`**sim(q, qi)**`ã€‚è¿™å¯¹åº”äºåµŒå…¥ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚é—®é¢˜`**q**`çš„ç­”æ¡ˆç›¸å…³æ€§å¾—åˆ†`**AR**`è®¡ç®—å¦‚ä¸‹ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*pE3MZF3cvPQX_qPq_dkpKA.png)

## ä¸Šä¸‹æ–‡ç›¸å…³æ€§

è¿™æ˜¯ä¸€ä¸ªè¡¡é‡æ£€ç´¢è´¨é‡çš„æŒ‡æ ‡ï¼Œä¸»è¦è¯„ä¼°æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡åœ¨å¤šå¤§ç¨‹åº¦ä¸Šæ”¯æŒæŸ¥è¯¢ã€‚ä½åˆ†è¡¨æ˜æ£€ç´¢åˆ°äº†å¤§é‡ä¸ç›¸å…³çš„å†…å®¹ï¼Œè¿™å¯èƒ½ä¼šå½±å“LLMç”Ÿæˆçš„æœ€ç»ˆç­”æ¡ˆã€‚ä¾‹å¦‚ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*jfbqIbMEAcojDoD_MRi22Q.png)

ä¸ºäº†ä¼°è®¡ä¸Šä¸‹æ–‡çš„ç›¸å…³æ€§ï¼Œä»ä¸Šä¸‹æ–‡ï¼ˆ`**c(q)**`ï¼‰ä¸­ä½¿ç”¨LLMæå–ä¸€ç»„å…³é”®å¥å­ï¼ˆ`**Sext**`ï¼‰ã€‚è¿™äº›å¥å­å¯¹äºå›ç­”é—®é¢˜è‡³å…³é‡è¦ã€‚æç¤ºå¦‚ä¸‹ï¼š

```python
è¯·ä»æä¾›çš„ä¸Šä¸‹æ–‡ä¸­æå–å¯èƒ½æœ‰åŠ©äºå›ç­”ä»¥ä¸‹é—®é¢˜çš„ç›¸å…³å¥å­ã€‚
å¦‚æœæœªæ‰¾åˆ°ç›¸å…³å¥å­ï¼Œæˆ–è€…æ‚¨è®¤ä¸ºæ— æ³•æ ¹æ®ç»™å®šçš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼Œ
è¯·è¿”å›çŸ­è¯­â€œInsufficient Informationâ€ã€‚
åœ¨æå–å€™é€‰å¥å­æ—¶ï¼Œä¸å…è®¸å¯¹ç»™å®šä¸Šä¸‹æ–‡ä¸­çš„å¥å­è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚
```

ç„¶åï¼Œåœ¨RAGAsä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å…¬å¼åœ¨å¥å­çº§åˆ«è®¡ç®—ç›¸å…³æ€§ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*-yWsfTEAw1KOKT0qoCGUjg.png)

## ä¸Šä¸‹æ–‡ä¸€è‡´æ€§è¯„ä¼°

è¯¥æŒ‡æ ‡è¡¡é‡æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸æ ‡æ³¨ç­”æ¡ˆä¹‹é—´çš„ä¸€è‡´æ€§ç¨‹åº¦ã€‚å®ƒé€šè¿‡ä½¿ç”¨çœŸå®æ ‡ç­¾å’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ¥è®¡ç®—ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºæ€§èƒ½è¶Šå¥½ã€‚ä¾‹å¦‚ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*fMAgzplM1FuA33KAXvZXyQ.png)

åœ¨å®æ–½æ—¶ï¼Œéœ€è¦æä¾›çœŸå®æ ‡ç­¾æ•°æ®ã€‚

è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*uIyxtKvWPxIwwn302XfS2g.png)

## ä¸Šä¸‹æ–‡ç²¾åº¦

è¯¥æŒ‡æ ‡ç›¸å¯¹å¤æ‚ï¼Œç”¨äºè¡¡é‡æ‰€æœ‰åŒ…å«çœŸå®äº‹å®çš„ç›¸å…³ä¸Šä¸‹æ–‡æ˜¯å¦éƒ½è¢«æ’åœ¨æœ€å‰é¢ã€‚åˆ†æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºç²¾åº¦è¶Šé«˜ã€‚

è¯¥æŒ‡æ ‡çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*uQGuHPp5hbrLZv0WacyZKg.png)

ä¸Šä¸‹æ–‡ç²¾åº¦çš„ä¼˜åŠ¿åœ¨äºå…¶èƒ½å¤Ÿæ„ŸçŸ¥æ’åºæ•ˆæœã€‚ç„¶è€Œï¼Œå…¶ç¼ºç‚¹æ˜¯å¦‚æœç›¸å…³å¬å›éå¸¸å°‘ï¼Œä½†å®ƒä»¬éƒ½æ’åå¾ˆé«˜ï¼Œåˆ†æ•°ä¹Ÿä¼šå¾ˆé«˜ã€‚å› æ­¤ï¼Œéœ€è¦ç»“åˆå…¶ä»–å‡ ä¸ªæŒ‡æ ‡æ¥ç»¼åˆè€ƒè™‘æ•´ä½“æ•ˆæœã€‚

# ä½¿ç”¨ RAGAs + LlamaIndex è¿›è¡Œ RAG è¯„ä¼°

ä¸»è¦æµç¨‹å¦‚å›¾ 6 æ‰€ç¤ºï¼š

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*JjIjndOyuMuxnDnkOV-Vxw.png)

## ç¯å¢ƒé…ç½®

å®‰è£… ragasï¼š`pip install ragas`ã€‚ç„¶åï¼Œæ£€æŸ¥å½“å‰ç‰ˆæœ¬ã€‚

```python
(py) Florian:~ Florian$ pip list | grep ragas
ragas                        0.0.22
```
å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨ `pip install git+https://github.com/explodinggradients/ragas.git` å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼ˆv0.1.0rc1ï¼‰ï¼Œåˆ™ä¸æ”¯æŒ LlamaIndexã€‚

æ¥ä¸‹æ¥ï¼Œå¯¼å…¥ç›¸å…³åº“ï¼Œè®¾ç½®ç¯å¢ƒå’Œå…¨å±€å˜é‡

```python
import os
os.environ["OPENAI_API_KEY"] = "YOUR_OPENAI_KEY"
dir_path = "YOUR_DIR_PATH"

from llama_index import VectorStoreIndex, SimpleDirectoryReader

from ragas.metrics import (
    faithfulness,
    answer_relevancy,
    context_relevancy,
    context_recall,
    context_precision
)

from ragas.llama_index import evaluate
```
ç›®å½•ä¸­åªæœ‰ä¸€ä¸ªPDFæ–‡ä»¶ï¼Œä½¿ç”¨çš„æ˜¯è®ºæ–‡â€œ[TinyLlama: An Open-Source Small Language Model](https://arxiv.org/pdf/2401.02385.pdf)â€ã€‚

```python
(py) Florian:~ Florian$ ls /Users/Florian/Downloads/pdf_test/
tinyllama.pdf
```

## ä½¿ç”¨ LlamaIndex æ„å»ºä¸€ä¸ªç®€å•çš„ RAG æŸ¥è¯¢å¼•æ“

```python
documents = SimpleDirectoryReader(dir_path).load_data()
index = VectorStoreIndex.from_documents(documents)
query_engine = index.as_query_engine()
```
é»˜è®¤æƒ…å†µä¸‹ï¼ŒLlamaIndex ä½¿ç”¨ OpenAI æ¨¡å‹ï¼ŒLLM å’ŒåµŒå…¥æ¨¡å‹å¯ä»¥é€šè¿‡ ServiceContext è½»æ¾é…ç½®ã€‚

## æ„å»ºè¯„ä¼°æ•°æ®é›†

ç”±äºæŸäº›æŒ‡æ ‡éœ€è¦æ‰‹åŠ¨æ ‡æ³¨çš„æ•°æ®é›†ï¼Œæˆ‘è‡ªè¡Œç¼–å†™äº†ä¸€äº›é—®é¢˜åŠå…¶å¯¹åº”çš„ç­”æ¡ˆã€‚

```python
eval_questions = [
    "èƒ½å¦ç®€è¦æè¿°TinyLlamaæ¨¡å‹çš„ç‰¹ç‚¹ï¼Ÿ",
    "æˆ‘æƒ³äº†è§£TinyLlamaåœ¨é€Ÿåº¦ä¼˜åŒ–æ–¹é¢åšäº†å“ªäº›æ”¹è¿›ï¼Ÿ",
    "ä¸ºä»€ä¹ˆTinyLlamaä½¿ç”¨Grouped-query Attentionï¼Ÿ",
    "TinyLlamaæ¨¡å‹æ˜¯å¼€æºçš„å—ï¼Ÿ",
    "è¯·ä»‹ç»ä¸€ä¸‹starcoderdataæ•°æ®é›†",
]
eval_answers = [
    "TinyLlamaæ˜¯ä¸€ä¸ªç´§å‡‘çš„1.1Bè¯­è¨€æ¨¡å‹ï¼Œåœ¨å¤§çº¦1ä¸‡äº¿ä¸ªtokenä¸Šé¢„è®­ç»ƒäº†çº¦3ä¸ªå‘¨æœŸã€‚åŸºäºLlama 2çš„æ¶æ„å’Œåˆ†è¯å™¨ï¼ŒTinyLlamaåˆ©ç”¨äº†å¼€æºç¤¾åŒºè´¡çŒ®çš„å„ç§å…ˆè¿›æŠ€æœ¯ï¼ˆä¾‹å¦‚FlashAttentionï¼‰ï¼Œå®ç°äº†æ›´å¥½çš„è®¡ç®—æ•ˆç‡ã€‚å°½ç®¡ä½“ç§¯ç›¸å¯¹è¾ƒå°ï¼ŒTinyLlamaåœ¨ä¸€ç³»åˆ—ä¸‹æ¸¸ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œæ˜¾è‘—ä¼˜äºç°æœ‰åŒè§„æ¨¡çš„å¼€æ”¾æºä»£ç è¯­è¨€æ¨¡å‹ã€‚",
    "åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç åº“é›†æˆäº†FSDPï¼Œä»¥é«˜æ•ˆåˆ©ç”¨å¤šGPUå’Œå¤šèŠ‚ç‚¹è®¾ç½®ã€‚å¦ä¸€ä¸ªå…³é”®æ”¹è¿›æ˜¯é›†æˆäº†Flash Attentionï¼Œä¸€ç§ä¼˜åŒ–çš„æ³¨æ„åŠ›æœºåˆ¶ã€‚æˆ‘ä»¬å°†xFormersï¼ˆLefaudeuxç­‰äººï¼Œ2022å¹´ï¼‰åº“ä¸­çš„èåˆSwiGLUæ¨¡å—æ›¿æ¢ä¸ºåŸå§‹çš„SwiGLUæ¨¡å—ï¼Œè¿›ä¸€æ­¥æé«˜äº†ä»£ç åº“çš„æ•ˆç‡ã€‚é€šè¿‡è¿™äº›ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘å†…å­˜å ç”¨ï¼Œä½¿1.1Bæ¨¡å‹èƒ½å¤Ÿé€‚åº”40GBçš„GPUå†…å­˜ã€‚",  
    "ä¸ºäº†å‡å°‘å†…å­˜å¸¦å®½å¼€é”€å¹¶åŠ é€Ÿæ¨ç†ï¼Œæˆ‘ä»¬åœ¨æ¨¡å‹ä¸­ä½¿ç”¨äº†grouped-query attentionã€‚æˆ‘ä»¬çš„æŸ¥è¯¢æ³¨æ„åŠ›æœ‰32ä¸ªå¤´ï¼Œå¹¶ä½¿ç”¨4ç»„é”®å€¼å¤´ã€‚é€šè¿‡è¿™ç§æŠ€æœ¯ï¼Œæ¨¡å‹å¯ä»¥åœ¨ä¸ç‰ºç‰²å¤ªå¤šæ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œè·¨å¤šä¸ªå¤´å…±äº«é”®å’Œå€¼è¡¨ç¤ºã€‚",
    "æ˜¯çš„ï¼ŒTinyLlamaæ˜¯å¼€æºçš„ã€‚",
    "è¯¥æ•°æ®é›†æ˜¯ä¸ºäº†è®­ç»ƒStarCoderï¼ˆLiç­‰äººï¼Œ2023å¹´ï¼‰ï¼Œä¸€ä¸ªå¼ºå¤§çš„å¼€æºå¤§å‹ä»£ç è¯­è¨€æ¨¡å‹è€Œæ”¶é›†çš„ã€‚å®ƒåŒ…å«çº¦2500äº¿ä¸ªtokenï¼Œæ¶µç›–86ç§ç¼–ç¨‹è¯­è¨€ã€‚é™¤äº†ä»£ç å¤–ï¼Œè¿˜åŒ…æ‹¬GitHubé—®é¢˜å’Œæ¶‰åŠè‡ªç„¶è¯­è¨€çš„æ–‡æœ¬-ä»£ç å¯¹ã€‚",
]
eval_answers = [[a] for a in eval_answers]
```

## æŒ‡æ ‡é€‰æ‹©ä¸RAGAsè¯„ä¼°

```python
metrics = [
    faithfulness,
    answer_relevancy,
    context_relevancy,
    context_precision,
    context_recall,
]

result = evaluate(query_engine, metrics, eval_questions, eval_answers)
result.to_pandas().to_csv('YOUR_CSV_PATH', sep=',')
```
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨RAGAsä¸­ï¼Œé»˜è®¤ä½¿ç”¨OpenAIæ¨¡å‹ã€‚

åœ¨RAGAsä¸­ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å…¶ä»–LLMï¼ˆå¦‚Geminiï¼‰ç»“åˆ**LlamaIndex**è¿›è¡Œè¯„ä¼°ï¼Œæˆ‘åœ¨RAGAsç‰ˆæœ¬0.0.22ä¸­å°šæœªæ‰¾åˆ°æœ‰æ•ˆæ–¹æ³•ï¼Œå³ä¾¿è°ƒè¯•äº†RAGAsçš„æºä»£ç ã€‚

## æœ€ç»ˆä»£ç 

```python
import os
os.environ["OPENAI_API_KEY"] = "YOUR_OPENAI_KEY"
dir_path = "YOUR_DIR_PATH"

from llama_index import VectorStoreIndex, SimpleDirectoryReader

from ragas.metrics import (
    faithfulness,
    answer_relevancy,
    context_relevancy,
    context_recall,
    context_precision
)

from ragas.llama_index import evaluate

documents = SimpleDirectoryReader(dir_path).load_data()
index = VectorStoreIndex.from_documents(documents)
query_engine = index.as_query_engine()

eval_questions = [
    "Can you provide a concise description of the TinyLlama model?",
    "I would like to know the speed optimizations that TinyLlama has made.",
    "Why TinyLlama uses Grouped-query Attention?",
    "Is the TinyLlama model open source?",
    "Tell me about starcoderdata dataset",
]
eval_answers = [
    "TinyLlama is a compact 1.1B language model pretrained on around 1 trillion tokens for approximately 3 epochs. Building on the architecture and tokenizer of Llama 2, TinyLlama leverages various advances contributed by the open-source community (e.g., FlashAttention), achieving better computational efficiency. Despite its relatively small size, TinyLlama demonstrates remarkable performance in a series of downstream tasks. It significantly outperforms existing open-source language models with comparable sizes.",
    "During training, our codebase has integrated FSDP to leverage multi-GPU and multi-node setups efficiently. Another critical improvement is the integration of Flash Attention, an optimized attention mechanism. We have replaced the fused SwiGLU module from the xFormers (Lefaudeux et al., 2022) repository with the original SwiGLU module, further enhancing the efficiency of our codebase. With these features, we can reduce the memory footprint, enabling the 1.1B model to fit within 40GB of GPU RAM.",  
    "To reduce memory bandwidth overhead and speed up inference, we use grouped-query attention in our model. We have 32 heads for query attention and use 4 groups of key-value heads. With this technique, the model can share key and value representations across multiple heads without sacrificing much performance",
    "Yes, TinyLlama is open-source",
    "This dataset was collected to train StarCoder (Li et al., 2023), a powerful opensource large code language model. It comprises approximately 250 billion tokens across 86 programming languages. In addition to code, it also includes GitHub issues and text-code pairs that involve natural languages.",
]
eval_answers = [[a] for a in eval_answers]

metrics = [
    faithfulness,
    answer_relevancy,
    context_relevancy,
    context_precision,
    context_recall,
]

result = evaluate(query_engine, metrics, eval_questions, eval_answers)
result.to_pandas().to_csv('YOUR_CSV_PATH', sep=',')
```
æ³¨æ„ï¼Œåœ¨ç»ˆç«¯è¿è¡Œç¨‹åºæ—¶ï¼Œpandas dataframe å¯èƒ½æ— æ³•å®Œå…¨æ˜¾ç¤ºã€‚è¦æŸ¥çœ‹å®ƒï¼Œå¯ä»¥å°†å…¶å¯¼å‡ºä¸º CSV æ–‡ä»¶ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºã€‚

![](https://cdn-images-1.readmedium.com/v2/resize:fit:800/1*-7Bh7n84dUxWNjE2VmbLXw.png)

ä»å›¾ 6 å¯ä»¥çœ‹å‡ºï¼Œç¬¬å››ä¸ªé—®é¢˜â€œ`Tell me about starcoderdata dataset`â€å…¨æ˜¯ 0ï¼Œè¿™æ˜¯å› ä¸º LLM æ— æ³•æä¾›ç­”æ¡ˆã€‚ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé—®é¢˜ä¸Šä¸‹æ–‡ç²¾åº¦ä¸º 0ï¼Œè¡¨æ˜æ£€ç´¢åˆ°çš„ç›¸å…³ä¸Šä¸‹æ–‡æ²¡æœ‰æ’åœ¨æœ€å‰é¢ã€‚ç¬¬äºŒä¸ªé—®é¢˜çš„ä¸Šä¸‹æ–‡å¬å›ç‡ä¸º 0ï¼Œè¡¨æ˜æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸æ ‡æ³¨ç­”æ¡ˆä¸åŒ¹é…ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç¬¬ 0 åˆ° 3 ä¸ªé—®é¢˜ã€‚è¿™äº›é—®é¢˜çš„ç­”æ¡ˆç›¸å…³æ€§å¾—åˆ†å¾ˆé«˜ï¼Œè¡¨æ˜ç­”æ¡ˆä¸é—®é¢˜ä¹‹é—´æœ‰å¾ˆå¼ºçš„å…³è”æ€§ã€‚æ­¤å¤–ï¼Œå¿ å®åº¦å¾—åˆ†å¹¶ä¸ä½ï¼Œè¿™è¡¨æ˜ç­”æ¡ˆä¸»è¦æ¥è‡ªä¸Šä¸‹æ–‡çš„æ¨å¯¼æˆ–æ€»ç»“ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼Œè¿™äº›ç­”æ¡ˆå¹¶é LLM å¹»è§‰äº§ç”Ÿã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å‘ç°å°½ç®¡ä¸Šä¸‹æ–‡ç›¸å…³æ€§å¾—åˆ†è¾ƒä½ï¼Œä½† gpt-3.5-turbo-16kï¼ˆRAGAs çš„é»˜è®¤æ¨¡å‹ï¼‰ä»èƒ½ä»ä¸­æ¨å¯¼å‡ºç­”æ¡ˆã€‚

æ ¹æ®ç»“æœï¼Œæ˜¾ç„¶è¿™ä¸ªåŸºæœ¬çš„ RAG ç³»ç»Ÿä»æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚

# ç»“è®º

æ€»ä½“è€Œè¨€ï¼ŒRAGAs æä¾›äº†å…¨é¢çš„æŒ‡æ ‡æ¥è¯„ä¼° RAGï¼Œå¹¶æä¾›äº†ä¾¿æ·çš„è°ƒç”¨æ–¹å¼ã€‚ç›®å‰ï¼ŒRAG è¯„ä¼°æ¡†æ¶å°šä¸å®Œå–„ï¼ŒRAGAs æä¾›äº†ä¸€ä¸ªæœ‰æ•ˆçš„å·¥å…·ã€‚

åœ¨è°ƒè¯• RAGAs çš„å†…éƒ¨æºä»£ç åï¼Œå¯ä»¥æ˜æ˜¾çœ‹å‡º RAGAs ä»å¤„äºæ—©æœŸå¼€å‘é˜¶æ®µã€‚æˆ‘ä»¬å¯¹å…¶æœªæ¥çš„æ›´æ–°å’Œæ”¹è¿›æŒä¹è§‚æ€åº¦ã€‚

æœ€åï¼Œå¦‚æœæ‚¨å¯¹æœ¬æ–‡æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åœ¨è¯„è®ºåŒºæŒ‡å‡ºã€‚

# ç”¨ç®€å•è‹±è¯­ ğŸš€

*æ„Ÿè°¢æ‚¨æˆä¸º[**ç”¨ç®€å•è‹±è¯­**](https://plainenglish.io)ç¤¾åŒºçš„ä¸€å‘˜ï¼åœ¨æ‚¨ç¦»å¼€ä¹‹å‰ï¼š*

* è¯·åŠ¡å¿…**ç‚¹èµ**å¹¶**å…³æ³¨**ä½œè€…ï¸ğŸ‘**ï¸ï¸**
* å…³æ³¨æˆ‘ä»¬ï¼š[**X**](https://twitter.com/inPlainEngHQ) **| [LinkedIn](https://www.linkedin.com/company/inplainenglish/) | [YouTube](https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw) | [Discord](https://discord.gg/in-plain-english-709094664682340443) | [Newsletter](https://newsletter.plainenglish.io/)**
* è®¿é—®æˆ‘ä»¬çš„å…¶ä»–å¹³å°ï¼š[**Stackademic**](https://stackademic.com/) **| [CoFeed](https://cofeed.app/) | [Venture](https://venturemagazine.net/)**
* æ›´å¤šå†…å®¹è¯·è®¿é—®[**PlainEnglish.io**](https://plainenglish.io)
